# é¸¡è‚‰å“è´¨åˆ†çº§ä¸åˆ†ç±»æ£€æµ‹ç³»ç»Ÿæºç åˆ†äº«
 # [ä¸€æ¡é¾™æ•™å­¦YOLOV8æ ‡æ³¨å¥½çš„æ•°æ®é›†ä¸€é”®è®­ç»ƒ_70+å…¨å¥—æ”¹è¿›åˆ›æ–°ç‚¹å‘åˆŠ_Webå‰ç«¯å±•ç¤º]

### 1.ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

é¡¹ç›®å‚è€ƒ[AAAI Association for the Advancement of Artificial Intelligence](https://gitee.com/qunshansj/projects)

é¡¹ç›®æ¥æº[AACV Association for the Advancement of Computer Vision](https://gitee.com/qunmasj/projects)

ç ”ç©¶èƒŒæ™¯ä¸æ„ä¹‰

éšç€å…¨çƒç»æµçš„å‘å±•å’Œäººä»¬ç”Ÿæ´»æ°´å¹³çš„æé«˜ï¼Œè‚‰ç±»æ¶ˆè´¹å°¤å…¶æ˜¯é¸¡è‚‰çš„éœ€æ±‚æŒç»­å¢é•¿ã€‚é¸¡è‚‰å› å…¶é«˜è›‹ç™½ã€ä½è„‚è‚ªçš„ç‰¹æ€§ï¼Œæˆä¸ºäº†äººä»¬é¤æ¡Œä¸Šä¸å¯æˆ–ç¼ºçš„é£Ÿå“ä¹‹ä¸€ã€‚ç„¶è€Œï¼Œé¸¡è‚‰çš„å“è´¨ç›´æ¥å½±å“åˆ°æ¶ˆè´¹è€…çš„å¥åº·å’Œé¥®é£Ÿä½“éªŒï¼Œå› æ­¤ï¼Œå»ºç«‹ä¸€ä¸ªé«˜æ•ˆã€å‡†ç¡®çš„é¸¡è‚‰å“è´¨åˆ†çº§ä¸åˆ†ç±»ç³»ç»Ÿæ˜¾å¾—å°¤ä¸ºé‡è¦ã€‚ä¼ ç»Ÿçš„é¸¡è‚‰å“è´¨è¯„ä¼°æ–¹æ³•å¤šä¾èµ–äºäººå·¥æ£€éªŒï¼Œä¸ä»…è€—æ—¶è€—åŠ›ï¼Œè€Œä¸”å—ä¸»è§‚å› ç´ å½±å“è¾ƒå¤§ï¼Œéš¾ä»¥ä¿è¯ä¸€è‡´æ€§å’Œå‡†ç¡®æ€§ã€‚å› æ­¤ï¼ŒåŸºäºè®¡ç®—æœºè§†è§‰å’Œæ·±åº¦å­¦ä¹ æŠ€æœ¯çš„è‡ªåŠ¨åŒ–æ£€æµ‹ç³»ç»Ÿåº”è¿è€Œç”Ÿï¼Œæˆä¸ºè§£å†³è¿™ä¸€é—®é¢˜çš„æœ‰æ•ˆé€”å¾„ã€‚

åœ¨ä¼—å¤šæ·±åº¦å­¦ä¹ æ¨¡å‹ä¸­ï¼ŒYOLOï¼ˆYou Only Look Onceï¼‰ç³»åˆ—å› å…¶å¿«é€Ÿçš„æ£€æµ‹é€Ÿåº¦å’Œè¾ƒé«˜çš„å‡†ç¡®ç‡è€Œå¹¿æ³›åº”ç”¨äºç‰©ä½“æ£€æµ‹é¢†åŸŸã€‚YOLOv8ä½œä¸ºè¯¥ç³»åˆ—çš„æœ€æ–°ç‰ˆæœ¬ï¼Œç»“åˆäº†å¤šç§å…ˆè¿›çš„æŠ€æœ¯å’Œä¼˜åŒ–ç­–ç•¥ï¼Œèƒ½å¤Ÿåœ¨å®æ—¶æ€§å’Œç²¾åº¦ä¹‹é—´å–å¾—è‰¯å¥½çš„å¹³è¡¡ã€‚é’ˆå¯¹é¸¡è‚‰å“è´¨çš„åˆ†çº§ä¸åˆ†ç±»ä»»åŠ¡ï¼Œæ”¹è¿›YOLOv8æ¨¡å‹ä¸ä»…å¯ä»¥æé«˜æ£€æµ‹çš„å‡†ç¡®æ€§ï¼Œè¿˜èƒ½æœ‰æ•ˆç¼©çŸ­æ£€æµ‹æ—¶é—´ï¼Œä¸ºç”Ÿäº§å’Œé”€å”®ç¯èŠ‚æä¾›å®æ—¶åé¦ˆï¼Œè¿›è€Œæå‡æ•´ä¸ªä¾›åº”é“¾çš„æ•ˆç‡ã€‚

æœ¬ç ”ç©¶æ‰€ä½¿ç”¨çš„æ•°æ®é›†åŒ…å«1800å¼ é¸¡è‚‰å›¾åƒï¼Œæ¶µç›–äº†äº”ä¸ªä¸åŒçš„ç±»åˆ«ï¼šChicken_ClassAã€Chicken_ClassA+ã€Chicken_ClassBã€Chicken_ClassCä»¥åŠNot_Whole_Chickenã€‚è¿™äº›ç±»åˆ«çš„åˆ’åˆ†ä¸ä»…åæ˜ äº†é¸¡è‚‰çš„å¤–è§‚ç‰¹å¾ï¼Œè¿˜ä¸å…¶å¸‚åœºä»·å€¼å’Œæ¶ˆè´¹è€…çš„é€‰æ‹©å¯†åˆ‡ç›¸å…³ã€‚é€šè¿‡å¯¹è¿™äº›å›¾åƒè¿›è¡Œæ·±åº¦å­¦ä¹ è®­ç»ƒï¼Œæ”¹è¿›YOLOv8æ¨¡å‹èƒ½å¤Ÿè‡ªåŠ¨è¯†åˆ«å’Œåˆ†ç±»ä¸åŒå“è´¨çš„é¸¡è‚‰ï¼Œè¿›è€Œä¸ºæ¶ˆè´¹è€…æä¾›æ›´ä¸ºç§‘å­¦çš„é€‰æ‹©ä¾æ®ã€‚åŒæ—¶ï¼Œè¯¥ç³»ç»Ÿçš„åº”ç”¨ä¹Ÿå°†æ¨åŠ¨é¸¡è‚‰è¡Œä¸šçš„æ ‡å‡†åŒ–è¿›ç¨‹ï¼Œä¿ƒè¿›äº§å“è´¨é‡çš„æå‡ã€‚

æ­¤å¤–ï¼Œéšç€é£Ÿå“å®‰å…¨é—®é¢˜çš„æ—¥ç›Šä¸¥é‡ï¼Œæ¶ˆè´¹è€…å¯¹é£Ÿå“è´¨é‡çš„å…³æ³¨åº¦ä¸æ–­æé«˜ã€‚å»ºç«‹ä¸€ä¸ªåŸºäºæ”¹è¿›YOLOv8çš„é¸¡è‚‰å“è´¨åˆ†çº§ä¸åˆ†ç±»ç³»ç»Ÿï¼Œä¸ä»…å¯ä»¥æå‡æ¶ˆè´¹è€…å¯¹äº§å“çš„ä¿¡ä»»åº¦ï¼Œè¿˜èƒ½å¸®åŠ©ç”Ÿäº§ä¼ä¸šä¼˜åŒ–ç”Ÿäº§æµç¨‹ï¼Œé™ä½å› å“è´¨é—®é¢˜å¯¼è‡´çš„ç»æµæŸå¤±ã€‚é€šè¿‡å®ç°æ™ºèƒ½åŒ–çš„å“è´¨æ£€æµ‹ï¼Œä¼ä¸šèƒ½å¤Ÿæ›´å¥½åœ°æ»¡è¶³å¸‚åœºéœ€æ±‚ï¼Œæå‡ç«äº‰åŠ›ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼ŒåŸºäºæ”¹è¿›YOLOv8çš„é¸¡è‚‰å“è´¨åˆ†çº§ä¸åˆ†ç±»ç³»ç»Ÿçš„ç ”ç©¶ï¼Œä¸ä»…å…·æœ‰é‡è¦çš„ç†è®ºæ„ä¹‰ï¼Œè¿˜å…·æœ‰å¹¿æ³›çš„åº”ç”¨å‰æ™¯ã€‚å®ƒå°†ä¸ºé¸¡è‚‰è¡Œä¸šçš„æ™ºèƒ½åŒ–å‘å±•æä¾›æ–°çš„æ€è·¯å’Œæ–¹æ³•ï¼Œæ¨åŠ¨é£Ÿå“è´¨é‡æ£€æµ‹æŠ€æœ¯çš„è¿›æ­¥ï¼Œæœ€ç»ˆå®ç°æå‡æ¶ˆè´¹è€…æ»¡æ„åº¦å’Œä¿éšœé£Ÿå“å®‰å…¨çš„ç›®æ ‡ã€‚

### 2.å›¾ç‰‡æ¼”ç¤º

![1.png](1.png)

![2.png](2.png)

![3.png](3.png)

##### æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ2.å›¾ç‰‡æ¼”ç¤ºâ€å’Œâ€œ3.è§†é¢‘æ¼”ç¤ºâ€å±•ç¤ºçš„ç³»ç»Ÿå›¾ç‰‡æˆ–è€…è§†é¢‘å¯èƒ½ä¸ºè€ç‰ˆæœ¬ï¼Œæ–°ç‰ˆæœ¬åœ¨è€ç‰ˆæœ¬çš„åŸºç¡€ä¸Šå‡çº§å¦‚ä¸‹ï¼šï¼ˆå®é™…æ•ˆæœä»¥å‡çº§çš„æ–°ç‰ˆæœ¬ä¸ºå‡†ï¼‰

  ï¼ˆ1ï¼‰é€‚é…äº†YOLOV8çš„â€œç›®æ ‡æ£€æµ‹â€æ¨¡å‹å’Œâ€œå®ä¾‹åˆ†å‰²â€æ¨¡å‹ï¼Œé€šè¿‡åŠ è½½ç›¸åº”çš„æƒé‡ï¼ˆ.ptï¼‰æ–‡ä»¶å³å¯è‡ªé€‚åº”åŠ è½½æ¨¡å‹ã€‚

  ï¼ˆ2ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«æ¨¡å¼ã€‚

  ï¼ˆ3ï¼‰æ”¯æŒâ€œå›¾ç‰‡è¯†åˆ«â€ã€â€œè§†é¢‘è¯†åˆ«â€ã€â€œæ‘„åƒå¤´å®æ—¶è¯†åˆ«â€ä¸‰ç§è¯†åˆ«ç»“æœä¿å­˜å¯¼å‡ºï¼Œè§£å†³æ‰‹åŠ¨å¯¼å‡ºï¼ˆå®¹æ˜“å¡é¡¿å‡ºç°çˆ†å†…å­˜ï¼‰å­˜åœ¨çš„é—®é¢˜ï¼Œè¯†åˆ«å®Œè‡ªåŠ¨ä¿å­˜ç»“æœå¹¶å¯¼å‡ºåˆ°tempDirä¸­ã€‚

  ï¼ˆ4ï¼‰æ”¯æŒWebå‰ç«¯ç³»ç»Ÿä¸­çš„æ ‡é¢˜ã€èƒŒæ™¯å›¾ç­‰è‡ªå®šä¹‰ä¿®æ”¹ï¼Œåé¢æä¾›ä¿®æ”¹æ•™ç¨‹ã€‚

  å¦å¤–æœ¬é¡¹ç›®æä¾›è®­ç»ƒçš„æ•°æ®é›†å’Œè®­ç»ƒæ•™ç¨‹,æš‚ä¸æä¾›æƒé‡æ–‡ä»¶ï¼ˆbest.ptï¼‰,éœ€è¦æ‚¨æŒ‰ç…§æ•™ç¨‹è¿›è¡Œè®­ç»ƒåå®ç°å›¾ç‰‡æ¼”ç¤ºå’ŒWebå‰ç«¯ç•Œé¢æ¼”ç¤ºçš„æ•ˆæœã€‚

### 3.è§†é¢‘æ¼”ç¤º

[3.1 è§†é¢‘æ¼”ç¤º](https://www.bilibili.com/video/BV1Kp48e9EBu/)

### 4.æ•°æ®é›†ä¿¡æ¯å±•ç¤º

##### 4.1 æœ¬é¡¹ç›®æ•°æ®é›†è¯¦ç»†æ•°æ®ï¼ˆç±»åˆ«æ•°ï¼†ç±»åˆ«åï¼‰

nc: 5
names: ['Chicken_ClassA', 'Chicken_ClassA-', 'Chicken_ClassB', 'Chicken_ClassC', 'Not_Whole_Chicken']


##### 4.2 æœ¬é¡¹ç›®æ•°æ®é›†ä¿¡æ¯ä»‹ç»

æ•°æ®é›†ä¿¡æ¯å±•ç¤º

åœ¨ç°ä»£å†œä¸šä¸é£Ÿå“å®‰å…¨é¢†åŸŸï¼Œé¸¡è‚‰å“è´¨çš„åˆ†çº§ä¸åˆ†ç±»è‡³å…³é‡è¦ã€‚ä¸ºäº†æå‡è¿™ä¸€è¿‡ç¨‹çš„æ•ˆç‡ä¸å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªä¸“é—¨ç”¨äºè®­ç»ƒæ”¹è¿›YOLOv8æ¨¡å‹çš„é«˜è´¨é‡æ•°æ®é›†ï¼Œå‘½åä¸ºâ€œchick_detectorâ€ã€‚è¯¥æ•°æ®é›†æ—¨åœ¨é€šè¿‡æ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œå®ç°å¯¹é¸¡è‚‰å“è´¨çš„è‡ªåŠ¨åŒ–è¯†åˆ«ä¸åˆ†ç±»ï¼Œä»è€Œä¸ºç›¸å…³è¡Œä¸šæä¾›æ™ºèƒ½åŒ–è§£å†³æ–¹æ¡ˆã€‚

â€œchick_detectorâ€æ•°æ®é›†åŒ…å«äº”ä¸ªä¸»è¦ç±»åˆ«ï¼Œåˆ†åˆ«ä¸ºï¼šChicken_ClassAã€Chicken_ClassA-ã€Chicken_ClassBã€Chicken_ClassCä»¥åŠNot_Whole_Chickenã€‚è¿™äº›ç±»åˆ«çš„åˆ’åˆ†ä¸ä»…è€ƒè™‘äº†é¸¡è‚‰çš„å¤–è§‚ç‰¹å¾ï¼Œè¿˜ç»¼åˆäº†è‚‰è´¨ã€è‰²æ³½ã€çº¹ç†ç­‰å¤šç§å› ç´ ï¼Œç¡®ä¿æ¨¡å‹èƒ½å¤Ÿåœ¨å®é™…åº”ç”¨ä¸­åšå‡ºå‡†ç¡®çš„åˆ¤æ–­ã€‚å…·ä½“è€Œè¨€ï¼ŒChicken_ClassAä»£è¡¨çš„æ˜¯æœ€é«˜å“è´¨çš„é¸¡è‚‰ï¼Œé€šå¸¸å…·æœ‰é²œè‰³çš„è‰²æ³½å’Œè‰¯å¥½çš„çº¹ç†ï¼›è€ŒChicken_ClassA-åˆ™æ˜¯ç•¥ä½äºClassAçš„é¸¡è‚‰ï¼Œå¯èƒ½åœ¨æŸäº›æ–¹é¢å­˜åœ¨è½»å¾®çš„ç‘•ç–µã€‚Chicken_ClassBå’ŒChicken_ClassCåˆ™åˆ†åˆ«ä»£è¡¨ä¸­ç­‰å“è´¨å’Œè¾ƒä½å“è´¨çš„é¸¡è‚‰ï¼Œé€‚ç”¨äºä¸åŒçš„å¸‚åœºéœ€æ±‚ã€‚æœ€åï¼ŒNot_Whole_Chickenç±»åˆ«åˆ™ç”¨äºæ ‡è¯†é‚£äº›ä¸å®Œæ•´çš„é¸¡è‚‰äº§å“ï¼Œç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«å¹¶åˆ†ç±»è¿™äº›ç‰¹æ®Šæƒ…å†µã€‚

æ•°æ®é›†çš„æ„å»ºè¿‡ç¨‹ç»è¿‡äº†ä¸¥æ ¼çš„æ ‡å‡†åŒ–å’Œç­›é€‰ï¼Œç¡®ä¿æ¯ä¸ªç±»åˆ«çš„æ ·æœ¬éƒ½å…·æœ‰ä»£è¡¨æ€§ã€‚ä¸ºäº†æé«˜æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ï¼Œæˆ‘ä»¬åœ¨æ•°æ®é‡‡é›†é˜¶æ®µæ¶µç›–äº†å¤šç§ä¸åŒæ¥æºçš„é¸¡è‚‰æ ·æœ¬ï¼ŒåŒ…æ‹¬è¶…å¸‚ã€å†œåœºå’ŒåŠ å·¥å‚ç­‰ã€‚è¿™ç§å¤šæ ·æ€§ä¸ä»…ä¸°å¯Œäº†æ•°æ®é›†çš„å†…å®¹ï¼Œä¹Ÿä¸ºæ¨¡å‹çš„è®­ç»ƒæä¾›äº†æ›´ä¸ºå¹¿æ³›çš„èƒŒæ™¯ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œæ•°æ®é›†ä¸­æ¯ä¸ªæ ·æœ¬éƒ½ç»è¿‡ç²¾ç»†æ ‡æ³¨ï¼Œç¡®ä¿è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®å‡†ç¡®æ€§ï¼Œè¿›è€Œæå‡æ¨¡å‹çš„æ€§èƒ½ã€‚

åœ¨æ•°æ®é›†çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†æ•°æ®å¢å¼ºæŠ€æœ¯ï¼Œä»¥å¢åŠ æ ·æœ¬çš„å¤šæ ·æ€§å’Œæ•°é‡ã€‚è¿™äº›æŠ€æœ¯åŒ…æ‹¬æ—‹è½¬ã€ç¼©æ”¾ã€è£å‰ªã€é¢œè‰²å˜æ¢ç­‰ï¼Œæ—¨åœ¨æ¨¡æ‹Ÿä¸åŒçš„æ‹æ‘„æ¡ä»¶å’Œç¯å¢ƒå˜åŒ–ï¼Œä»è€Œä½¿æ¨¡å‹åœ¨é¢å¯¹å®é™…åº”ç”¨æ—¶æ›´åŠ é²æ£’ã€‚é€šè¿‡è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬æœŸæœ›èƒ½å¤Ÿè®­ç»ƒå‡ºä¸€ä¸ªé«˜æ•ˆä¸”å‡†ç¡®çš„YOLOv8æ¨¡å‹ï¼Œèƒ½å¤Ÿåœ¨å®æ—¶åœºæ™¯ä¸­å¿«é€Ÿè¯†åˆ«å’Œåˆ†ç±»é¸¡è‚‰å“è´¨ã€‚

æ­¤å¤–ï¼Œæ•°æ®é›†çš„è®¾è®¡ä¹Ÿè€ƒè™‘åˆ°äº†å®é™…åº”ç”¨ä¸­çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œåœ¨é£Ÿå“åŠ å·¥å’Œé”€å”®ç¯èŠ‚ï¼Œå¿«é€Ÿè€Œå‡†ç¡®çš„é¸¡è‚‰å“è´¨åˆ†ç±»èƒ½å¤Ÿæ˜¾è‘—æé«˜å·¥ä½œæ•ˆç‡ï¼Œå‡å°‘äººåŠ›æˆæœ¬ï¼Œå¹¶é™ä½å› å“è´¨ä¸åˆæ ¼è€Œå¯¼è‡´çš„ç»æµæŸå¤±ã€‚å› æ­¤ï¼Œâ€œchick_detectorâ€ä¸ä»…æ˜¯ä¸€ä¸ªæŠ€æœ¯æ€§çš„æ•°æ®é›†ï¼Œæ›´æ˜¯ä¸€ä¸ªèƒ½å¤Ÿä¸ºè¡Œä¸šå¸¦æ¥å®é™…ä»·å€¼çš„å·¥å…·ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œâ€œchick_detectorâ€æ•°æ®é›†ä¸ºæ”¹è¿›YOLOv8çš„é¸¡è‚‰å“è´¨åˆ†çº§ä¸åˆ†ç±»ç³»ç»Ÿæä¾›äº†åšå®çš„åŸºç¡€ã€‚é€šè¿‡é«˜è´¨é‡çš„æ ·æœ¬ã€å¤šæ ·åŒ–çš„ç±»åˆ«å’Œä¸¥æ ¼çš„æ ‡æ³¨ï¼Œæˆ‘ä»¬ç›¸ä¿¡è¯¥æ•°æ®é›†èƒ½å¤Ÿæœ‰æ•ˆæ”¯æŒç›¸å…³ç ”ç©¶ä¸åº”ç”¨ï¼Œæ¨åŠ¨é¸¡è‚‰å“è´¨æ£€æµ‹æŠ€æœ¯çš„è¿›æ­¥ä¸å‘å±•ã€‚

![4.png](4.png)

![5.png](5.png)

![6.png](6.png)

![7.png](7.png)

![8.png](8.png)

### 5.å…¨å¥—é¡¹ç›®ç¯å¢ƒéƒ¨ç½²è§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰

[5.1 ç¯å¢ƒéƒ¨ç½²æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404473917358506534?logTag=c807d0cbc21c0ef59de5)




[5.2 å®‰è£…Pythonè™šæ‹Ÿç¯å¢ƒåˆ›å»ºå’Œä¾èµ–åº“å®‰è£…è§†é¢‘æ•™ç¨‹é“¾æ¥ï¼ˆé›¶åŸºç¡€æ‰‹æŠŠæ‰‹æ•™å­¦ï¼‰](https://www.ixigua.com/7404474678003106304?logTag=1f1041108cd1f708b01a)

### 6.æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰

[6.1 æ‰‹æŠŠæ‰‹YOLOV8è®­ç»ƒè§†é¢‘æ•™ç¨‹ï¼ˆé›¶åŸºç¡€å°ç™½æœ‰æ‰‹å°±èƒ½å­¦ä¼šï¼‰](https://www.ixigua.com/7404477157818401292?logTag=d31a2dfd1983c9668658)

### 7.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰

[7.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹ä»£ç åŠ è½½è°ƒå‚è§†é¢‘æ•™ç¨‹ï¼ˆä¸€é”®åŠ è½½å†™å¥½çš„æ”¹è¿›æ¨¡å‹çš„é…ç½®æ–‡ä»¶ï¼‰](https://www.ixigua.com/7404478314661806627?logTag=29066f8288e3f4eea3a4)

### 8.70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£ï¼ˆéç§‘ç­ä¹Ÿå¯ä»¥è½»æ¾å†™åˆŠå‘åˆŠï¼ŒV10ç‰ˆæœ¬æ­£åœ¨ç§‘ç ”å¾…æ›´æ–°ï¼‰

ç”±äºç¯‡å¹…é™åˆ¶ï¼Œæ¯ä¸ªåˆ›æ–°ç‚¹çš„å…·ä½“åŸç†è®²è§£å°±ä¸ä¸€ä¸€å±•å¼€ï¼Œå…·ä½“è§ä¸‹åˆ—ç½‘å€ä¸­çš„åˆ›æ–°ç‚¹å¯¹åº”å­é¡¹ç›®çš„æŠ€æœ¯åŸç†åšå®¢ç½‘å€ã€Blogã€‘ï¼š

![9.png](9.png)

[8.1 70+ç§å…¨å¥—YOLOV8åˆ›æ–°ç‚¹åŸç†è®²è§£é“¾æ¥](https://gitee.com/qunmasj/good)

### 9.ç³»ç»ŸåŠŸèƒ½å±•ç¤ºï¼ˆæ£€æµ‹å¯¹è±¡ä¸ºä¸¾ä¾‹ï¼Œå®é™…å†…å®¹ä»¥æœ¬é¡¹ç›®æ•°æ®é›†ä¸ºå‡†ï¼‰

å›¾9.1.ç³»ç»Ÿæ”¯æŒæ£€æµ‹ç»“æœè¡¨æ ¼æ˜¾ç¤º

  å›¾9.2.ç³»ç»Ÿæ”¯æŒç½®ä¿¡åº¦å’ŒIOUé˜ˆå€¼æ‰‹åŠ¨è°ƒèŠ‚

  å›¾9.3.ç³»ç»Ÿæ”¯æŒè‡ªå®šä¹‰åŠ è½½æƒé‡æ–‡ä»¶best.pt(éœ€è¦ä½ é€šè¿‡æ­¥éª¤5ä¸­è®­ç»ƒè·å¾—)

  å›¾9.4.ç³»ç»Ÿæ”¯æŒæ‘„åƒå¤´å®æ—¶è¯†åˆ«

  å›¾9.5.ç³»ç»Ÿæ”¯æŒå›¾ç‰‡è¯†åˆ«

  å›¾9.6.ç³»ç»Ÿæ”¯æŒè§†é¢‘è¯†åˆ«

  å›¾9.7.ç³»ç»Ÿæ”¯æŒè¯†åˆ«ç»“æœæ–‡ä»¶è‡ªåŠ¨ä¿å­˜

  å›¾9.8.ç³»ç»Ÿæ”¯æŒExcelå¯¼å‡ºæ£€æµ‹ç»“æœæ•°æ®

![10.png](10.png)

![11.png](11.png)

![12.png](12.png)

![13.png](13.png)

![14.png](14.png)

![15.png](15.png)

![16.png](16.png)

![17.png](17.png)

### 10.åŸå§‹YOLOV8ç®—æ³•åŸç†

åŸå§‹YOLOv8ç®—æ³•åŸç†

YOLOv8æ˜¯ç”±Ultralyticså…¬å¸äº2023å¹´1æœˆ10æ—¥å‘å¸ƒçš„æœ€æ–°ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œä½œä¸ºYOLOç³»åˆ—çš„åˆä¸€é‡è¦ç‰ˆæœ¬ï¼Œå®ƒåœ¨YOLOv7çš„åŸºç¡€ä¸Šè¿›è¡Œäº†æ·±åº¦ä¼˜åŒ–ï¼Œå±•ç°å‡ºæ›´ä¸ºå“è¶Šçš„æ€§èƒ½ã€‚YOLOv8çš„è®¾è®¡ç†å¿µæ˜¯é€šè¿‡å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰ç›´æ¥å¯¹æ•´ä¸ªå›¾åƒè¿›è¡Œå¤„ç†ï¼Œé¿å…äº†ä¼ ç»Ÿç›®æ ‡æ£€æµ‹æ–¹æ³•ä¸­æ»‘åŠ¨çª—å£å’ŒåŒºåŸŸæè®®çš„å¤æ‚æ€§ï¼Œä»è€Œæ˜¾è‘—æé«˜äº†æ£€æµ‹çš„é€Ÿåº¦å’Œç²¾åº¦ã€‚è¿™ç§ç«¯åˆ°ç«¯çš„æ£€æµ‹æ–¹å¼ä½¿å¾—YOLOv8èƒ½å¤Ÿåœ¨å®æ—¶åº”ç”¨ä¸­è¡¨ç°å‡ºè‰²ï¼Œå°¤å…¶æ˜¯åœ¨æ™ºèƒ½ç›‘æ§ã€è‡ªåŠ¨é©¾é©¶å’Œäººè„¸è¯†åˆ«ç­‰é¢†åŸŸã€‚

YOLOv8çš„ç½‘ç»œç»“æ„ç”±è¾“å…¥å±‚ã€ä¸»å¹²ç½‘ç»œã€é¢ˆéƒ¨ç½‘ç»œå’Œå¤´éƒ¨ç½‘ç»œå››ä¸ªä¸»è¦éƒ¨åˆ†ç»„æˆã€‚è¾“å…¥å±‚è´Ÿè´£å¯¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾ã€ç°åº¦å¡«å……å’ŒMosaicæ•°æ®å¢å¼ºç­‰ï¼Œä»¥ç¡®ä¿è¾“å…¥æ•°æ®ç¬¦åˆç½‘ç»œçš„è¦æ±‚ã€‚ä¸»å¹²ç½‘ç»œæ˜¯YOLOv8çš„æ ¸å¿ƒï¼Œé€šè¿‡ä¸€ç³»åˆ—å·ç§¯æ“ä½œå¯¹è¾“å…¥å›¾åƒè¿›è¡Œç‰¹å¾æå–ã€‚æ¯ä¸ªå·ç§¯å±‚éƒ½åŒ…å«æ‰¹å½’ä¸€åŒ–å’ŒSiLUæ¿€æ´»å‡½æ•°ï¼Œä»¥æé«˜æ¨¡å‹çš„æ”¶æ•›é€Ÿåº¦å’Œéçº¿æ€§è¡¨è¾¾èƒ½åŠ›ã€‚ç‰¹åˆ«åœ°ï¼ŒYOLOv8å¼•å…¥äº†C2fæ¨¡å—ï¼Œè¿™ä¸€æ¨¡å—å€Ÿé‰´äº†YOLOv7ä¸­çš„E-ELANç»“æ„ï¼Œé€šè¿‡è·¨å±‚åˆ†æ”¯è¿æ¥æ¥å¢å¼ºæ¨¡å‹çš„æ¢¯åº¦æµï¼Œè¿›è€Œæ”¹å–„ç›®æ ‡æ£€æµ‹çš„æ•ˆæœã€‚

åœ¨ç‰¹å¾æå–çš„è¿‡ç¨‹ä¸­ï¼ŒYOLOv8çš„ä¸»å¹²ç½‘ç»œè¿˜é‡‡ç”¨äº†SPPï¼ˆSpatial Pyramid Poolingï¼‰ç»“æ„ï¼Œè¯¥ç»“æ„é€šè¿‡å¤šä¸ªæœ€å¤§æ± åŒ–å±‚å¤„ç†å¤šå°ºåº¦ç‰¹å¾ï¼Œä»è€Œæå‡äº†ç½‘ç»œçš„ç‰¹å¾æŠ½è±¡èƒ½åŠ›ã€‚è¿™ä¸€è®¾è®¡ä½¿å¾—YOLOv8èƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ä¸åŒå¤§å°çš„ç›®æ ‡ï¼Œå°¤å…¶æ˜¯åœ¨å¤æ‚åœºæ™¯ä¸­ï¼Œèƒ½å¤Ÿæœ‰æ•ˆåœ°æ•æ‰åˆ°ç»†èŠ‚ä¿¡æ¯ã€‚é¢ˆéƒ¨ç½‘ç»œåˆ™åˆ©ç”¨ç‰¹å¾é‡‘å­—å¡”ç½‘ç»œï¼ˆFPNï¼‰å’Œè·¯å¾„èšåˆç½‘ç»œï¼ˆPANï¼‰ç»“æ„ï¼Œå°†ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾è¿›è¡Œèåˆï¼Œç¡®ä¿ä¿¡æ¯çš„æœ‰æ•ˆä¼ é€’ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒYOLOv8èƒ½å¤Ÿç»¼åˆè€ƒè™‘å¤šå±‚æ¬¡çš„ç‰¹å¾ä¿¡æ¯ï¼Œä»è€Œæå‡ç›®æ ‡æ£€æµ‹çš„ç²¾åº¦ã€‚

åœ¨è¾“å‡ºç«¯ï¼ŒYOLOv8é‡‡ç”¨äº†è§£è€¦çš„æ£€æµ‹å¤´è®¾è®¡ï¼Œé€šè¿‡ä¸¤ä¸ªå¹¶è¡Œçš„å·ç§¯åˆ†æ”¯åˆ†åˆ«è®¡ç®—å›å½’å’Œåˆ†ç±»çš„æŸå¤±ã€‚è¿™ç§è§£è€¦çš„æ–¹å¼ä½¿å¾—æ¨¡å‹åœ¨å¤„ç†åˆ†ç±»å’Œå®šä½ä»»åŠ¡æ—¶èƒ½å¤Ÿæ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚å…·ä½“è€Œè¨€ï¼ŒYOLOv8é‡‡ç”¨äº†Task-Aligned Assigneræ–¹æ³•ï¼Œå¯¹åˆ†ç±»åˆ†æ•°å’Œå›å½’åˆ†æ•°è¿›è¡ŒåŠ æƒï¼Œä»¥å®ç°æ›´ç²¾å‡†çš„æ­£æ ·æœ¬åŒ¹é…ã€‚æ­¤å¤–ï¼ŒæŸå¤±è®¡ç®—æ–¹é¢ï¼ŒYOLOv8ä½¿ç”¨äº†äºŒå…ƒäº¤å‰ç†µï¼ˆBCEï¼‰æ¥è®¡ç®—åˆ†ç±»æŸå¤±ï¼Œå¹¶ç»“åˆåˆ†å¸ƒç„¦ç‚¹æŸå¤±ï¼ˆDFLï¼‰å’Œå®Œå…¨äº¤å¹¶æ¯”ï¼ˆCIoUï¼‰æŸå¤±å‡½æ•°æ¥ä¼˜åŒ–å›å½’æŸå¤±ã€‚è¿™äº›åˆ›æ–°çš„è®¾è®¡ä½¿å¾—YOLOv8åœ¨ç²¾åº¦å’Œé€Ÿåº¦ä¸Šéƒ½å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚

YOLOv8çš„å¦ä¸€ä¸ªé‡è¦ç‰¹ç‚¹æ˜¯å…¶é‡‡ç”¨äº†anchor-freeçš„æ–¹æ³•ï¼Œç›¸è¾ƒäºä¼ ç»Ÿçš„anchor-basedæ£€æµ‹æ–¹æ³•ï¼ŒYOLOv8åœ¨å¤æ‚ç¯å¢ƒä¸‹çš„æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦å‡æœ‰æ˜¾è‘—æé«˜ã€‚è¿™ä¸€æ–¹æ³•çš„ä¼˜åŠ¿åœ¨äºå®ƒèƒ½å¤Ÿæ›´å¥½åœ°é€‚åº”ä¸åŒå½¢çŠ¶å’Œå¤§å°çš„ç›®æ ‡ï¼Œå‡å°‘äº†å¯¹å…ˆéªŒæ¡†çš„ä¾èµ–ï¼Œä»è€Œæå‡äº†æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›å¤æ‚çš„åœºæ™¯ä¸­ï¼Œä¾‹å¦‚æ°´é¢ç¯å¢ƒä¸‹çš„å°ç›®æ ‡æ£€æµ‹ï¼ŒYOLOv8ä»ç„¶é¢ä¸´ç€å®šä½è¯¯å·®å’Œç›®æ ‡æ„ŸçŸ¥èƒ½åŠ›ä¸è¶³çš„é—®é¢˜ã€‚å› æ­¤ï¼Œé’ˆå¯¹è¿™äº›ä¸è¶³ï¼Œç ”ç©¶è€…ä»¬æå‡ºäº†å¯¹YOLOv8çš„æ”¹è¿›æ–¹æ¡ˆï¼Œå¦‚å¼•å…¥BiFormeråŒå±‚è·¯ç”±æ³¨æ„åŠ›æœºåˆ¶å’Œæ›´å°çš„æ£€æµ‹å¤´ï¼Œä»¥æå‡å¯¹å°ç›®æ ‡çš„æ„ŸçŸ¥èƒ½åŠ›ã€‚

æ€»çš„æ¥è¯´ï¼ŒYOLOv8åœ¨ç›®æ ‡æ£€æµ‹é¢†åŸŸå±•ç°å‡ºäº†å¼ºå¤§çš„æ€§èƒ½ï¼Œå…¶åˆ›æ–°çš„ç½‘ç»œç»“æ„å’Œé«˜æ•ˆçš„ç®—æ³•è®¾è®¡ä½¿å¾—å®ƒèƒ½å¤Ÿåœ¨å¤šç§åº”ç”¨åœºæ™¯ä¸­å‘æŒ¥é‡è¦ä½œç”¨ã€‚é€šè¿‡ä¸æ–­çš„ä¼˜åŒ–å’Œæ”¹è¿›ï¼ŒYOLOv8ä¸ä»…æé«˜äº†æ£€æµ‹ç²¾åº¦å’Œé€Ÿåº¦ï¼Œè¿˜ä¸ºåç»­çš„ç ”ç©¶å’Œåº”ç”¨æä¾›äº†å¹¿é˜”çš„ç©ºé—´ã€‚éšç€YOLOç³»åˆ—ç®—æ³•çš„ä¸æ–­æ¼”è¿›ï¼ŒYOLOv8æ— ç–‘æ˜¯å½“å‰ç›®æ ‡æ£€æµ‹æŠ€æœ¯çš„ä¸€ä¸ªé‡è¦é‡Œç¨‹ç¢‘ï¼Œå±•ç°äº†æ·±åº¦å­¦ä¹ åœ¨è®¡ç®—æœºè§†è§‰é¢†åŸŸçš„å·¨å¤§æ½œåŠ›ã€‚

![18.png](18.png)

### 11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰

#### 11.1 ui.py

ä»¥ä¸‹æ˜¯å¯¹ä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œä¿ç•™å’Œè¯¦ç»†æ³¨é‡Šçš„ç‰ˆæœ¬ï¼š

```python
import sys
import subprocess

def run_script(script_path):
    """
    ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

    Args:
        script_path (str): è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„

    Returns:
        None
    """
    # è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„
    python_path = sys.executable

    # æ„å»ºè¿è¡Œå‘½ä»¤ï¼Œä½¿ç”¨ streamlit è¿è¡ŒæŒ‡å®šçš„è„šæœ¬
    command = f'"{python_path}" -m streamlit run "{script_path}"'

    # æ‰§è¡Œå‘½ä»¤å¹¶ç­‰å¾…å…¶å®Œæˆ
    result = subprocess.run(command, shell=True)
    
    # æ£€æŸ¥å‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ï¼Œéé›¶è¡¨ç¤ºå‡ºé”™
    if result.returncode != 0:
        print("è„šæœ¬è¿è¡Œå‡ºé”™ã€‚")

# å®ä¾‹åŒ–å¹¶è¿è¡Œåº”ç”¨
if __name__ == "__main__":
    # æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„
    script_path = "web.py"  # è¿™é‡Œå¯ä»¥æ›¿æ¢ä¸ºå®é™…çš„è„šæœ¬è·¯å¾„

    # è°ƒç”¨å‡½æ•°è¿è¡Œè„šæœ¬
    run_script(script_path)
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥æ¨¡å—**ï¼š
   - `sys`ï¼šç”¨äºè®¿é—®ä¸ Python è§£é‡Šå™¨ç›¸å…³çš„å˜é‡å’Œå‡½æ•°ã€‚
   - `subprocess`ï¼šç”¨äºæ‰§è¡Œå¤–éƒ¨å‘½ä»¤å’Œä¸å…¶äº¤äº’ã€‚

2. **`run_script` å‡½æ•°**ï¼š
   - è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªè„šæœ¬è·¯å¾„ä½œä¸ºå‚æ•°ï¼Œå¹¶ä½¿ç”¨å½“å‰ Python ç¯å¢ƒè¿è¡Œè¯¥è„šæœ¬ã€‚
   - ä½¿ç”¨ `sys.executable` è·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œä»¥ç¡®ä¿è„šæœ¬åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­è¿è¡Œã€‚
   - æ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œä½¿ç”¨ `streamlit` æ¨¡å—è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚
   - ä½¿ç”¨ `subprocess.run` æ‰§è¡Œæ„å»ºçš„å‘½ä»¤ï¼Œå¹¶é€šè¿‡ `shell=True` å…è®¸åœ¨ shell ä¸­æ‰§è¡Œã€‚
   - æ£€æŸ¥å‘½ä»¤çš„è¿”å›ç ï¼Œå¦‚æœè¿”å›ç ä¸ä¸ºé›¶ï¼Œåˆ™è¡¨ç¤ºè„šæœ¬è¿è¡Œå‡ºé”™ï¼Œå¹¶æ‰“å°é”™è¯¯ä¿¡æ¯ã€‚

3. **ä¸»ç¨‹åºå—**ï¼š
   - ä½¿ç”¨ `if __name__ == "__main__":` ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥è„šæœ¬æ—¶æ‰ä¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚
   - æŒ‡å®šè¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ï¼ˆåœ¨è¿™é‡Œæ˜¯ `web.py`ï¼‰ã€‚
   - è°ƒç”¨ `run_script` å‡½æ•°æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `ui.py` çš„ä¸»è¦åŠŸèƒ½æ˜¯è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„ Python è„šæœ¬ï¼Œå…·ä½“æ¥è¯´æ˜¯ä½¿ç”¨ Streamlit æ¡†æ¶æ¥å¯åŠ¨ä¸€ä¸ª Web åº”ç”¨ã€‚ç¨‹åºé¦–å…ˆå¯¼å…¥äº†å¿…è¦çš„æ¨¡å—ï¼ŒåŒ…æ‹¬ `sys`ã€`os` å’Œ `subprocess`ï¼Œä»¥åŠä¸€ä¸ªè‡ªå®šä¹‰çš„è·¯å¾„å¤„ç†å‡½æ•° `abs_path`ã€‚

åœ¨ `run_script` å‡½æ•°ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰ Python è§£é‡Šå™¨çš„è·¯å¾„ï¼Œè¿™é€šè¿‡ `sys.executable` å®ç°ã€‚æ¥ç€ï¼Œæ„å»ºä¸€ä¸ªå‘½ä»¤å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå‘½ä»¤ä½¿ç”¨å½“å‰çš„ Python è§£é‡Šå™¨æ¥è¿è¡ŒæŒ‡å®šçš„è„šæœ¬ï¼Œå…·ä½“æ˜¯é€šè¿‡ `-m streamlit run` æ¥å¯åŠ¨ Streamlit åº”ç”¨ã€‚ç„¶åï¼Œä½¿ç”¨ `subprocess.run` æ¥æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚è¯¥å‡½æ•°ä¼šåœ¨ shell ä¸­è¿è¡Œå‘½ä»¤ï¼Œå¹¶ç­‰å¾…å…¶å®Œæˆã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œçš„è¿”å›ç ä¸ä¸ºé›¶ï¼Œè¡¨ç¤ºè¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†é”™è¯¯ï¼Œæ­¤æ—¶ä¼šæ‰“å°å‡ºâ€œè„šæœ¬è¿è¡Œå‡ºé”™â€çš„æç¤ºã€‚

åœ¨æ–‡ä»¶çš„æœ€åéƒ¨åˆ†ï¼Œä½¿ç”¨ `if __name__ == "__main__":` è¯­å¥æ¥ç¡®ä¿åªæœ‰åœ¨ç›´æ¥è¿è¡Œè¯¥è„šæœ¬æ—¶æ‰ä¼šæ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚è¿™é‡ŒæŒ‡å®šäº†è¦è¿è¡Œçš„è„šæœ¬è·¯å¾„ `web.py`ï¼Œå¹¶è°ƒç”¨ `run_script` å‡½æ•°æ¥å¯åŠ¨è¿™ä¸ªè„šæœ¬ã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶çš„ä½œç”¨æ˜¯ä¸ºç”¨æˆ·æä¾›ä¸€ä¸ªç®€å•çš„æ¥å£ï¼Œé€šè¿‡å‘½ä»¤è¡Œè¿è¡Œä¸€ä¸ª Streamlit Web åº”ç”¨ï¼Œå¹¶å¤„ç†å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚

#### 11.2 code\ultralytics\trackers\utils\matching.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import numpy as np
import scipy
from scipy.spatial.distance import cdist
from ultralytics.utils.metrics import bbox_ioa

def linear_assignment(cost_matrix: np.ndarray, thresh: float, use_lap: bool = True) -> tuple:
    """
    æ‰§è¡Œçº¿æ€§åˆ†é…ï¼Œä½¿ç”¨ scipy æˆ– lap.lapjvã€‚

    å‚æ•°:
        cost_matrix (np.ndarray): åŒ…å«åˆ†é…æˆæœ¬å€¼çš„çŸ©é˜µã€‚
        thresh (float): è®¤ä¸ºåˆ†é…æœ‰æ•ˆçš„é˜ˆå€¼ã€‚
        use_lap (bool, optional): æ˜¯å¦ä½¿ç”¨ lap.lapjvã€‚é»˜è®¤ä¸º Trueã€‚

    è¿”å›:
        åŒ…å«ä»¥ä¸‹å†…å®¹çš„å…ƒç»„:
            - åŒ¹é…çš„ç´¢å¼•
            - 'a' ä¸­æœªåŒ¹é…çš„ç´¢å¼•
            - 'b' ä¸­æœªåŒ¹é…çš„ç´¢å¼•
    """
    # å¦‚æœæˆæœ¬çŸ©é˜µä¸ºç©ºï¼Œè¿”å›ç©ºåŒ¹é…å’Œæ‰€æœ‰æœªåŒ¹é…çš„ç´¢å¼•
    if cost_matrix.size == 0:
        return np.empty((0, 2), dtype=int), tuple(range(cost_matrix.shape[0])), tuple(range(cost_matrix.shape[1]))

    if use_lap:
        # ä½¿ç”¨ lap.lapjv è¿›è¡Œçº¿æ€§åˆ†é…
        _, x, y = lap.lapjv(cost_matrix, extend_cost=True, cost_limit=thresh)
        matches = [[ix, mx] for ix, mx in enumerate(x) if mx >= 0]  # åŒ¹é…çš„ç´¢å¼•
        unmatched_a = np.where(x < 0)[0]  # 'a' ä¸­æœªåŒ¹é…çš„ç´¢å¼•
        unmatched_b = np.where(y < 0)[0]  # 'b' ä¸­æœªåŒ¹é…çš„ç´¢å¼•
    else:
        # ä½¿ç”¨ scipy.optimize.linear_sum_assignment è¿›è¡Œçº¿æ€§åˆ†é…
        x, y = scipy.optimize.linear_sum_assignment(cost_matrix)  # è¡Œ xï¼Œåˆ— y
        matches = np.asarray([[x[i], y[i]] for i in range(len(x)) if cost_matrix[x[i], y[i]] <= thresh])
        if len(matches) == 0:
            unmatched_a = list(np.arange(cost_matrix.shape[0]))
            unmatched_b = list(np.arange(cost_matrix.shape[1]))
        else:
            unmatched_a = list(set(np.arange(cost_matrix.shape[0])) - set(matches[:, 0]))
            unmatched_b = list(set(np.arange(cost_matrix.shape[1])) - set(matches[:, 1]))

    return matches, unmatched_a, unmatched_b

def iou_distance(atracks: list, btracks: list) -> np.ndarray:
    """
    åŸºäºäº¤å¹¶æ¯” (IoU) è®¡ç®—è½¨è¿¹ä¹‹é—´çš„æˆæœ¬ã€‚

    å‚æ•°:
        atracks (list[STrack] | list[np.ndarray]): è½¨è¿¹ 'a' æˆ–è¾¹ç•Œæ¡†çš„åˆ—è¡¨ã€‚
        btracks (list[STrack] | list[np.ndarray]): è½¨è¿¹ 'b' æˆ–è¾¹ç•Œæ¡†çš„åˆ—è¡¨ã€‚

    è¿”å›:
        (np.ndarray): åŸºäº IoU è®¡ç®—çš„æˆæœ¬çŸ©é˜µã€‚
    """
    # å°†è½¨è¿¹è½¬æ¢ä¸ºè¾¹ç•Œæ¡†æ ¼å¼
    atlbrs = [track.tlbr for track in atracks] if not isinstance(atracks[0], np.ndarray) else atracks
    btlbrs = [track.tlbr for track in btracks] if not isinstance(btracks[0], np.ndarray) else btracks

    # åˆå§‹åŒ– IoU çŸ©é˜µ
    ious = np.zeros((len(atlbrs), len(btlbrs)), dtype=np.float32)
    if len(atlbrs) and len(btlbrs):
        # è®¡ç®— IoU
        ious = bbox_ioa(
            np.ascontiguousarray(atlbrs, dtype=np.float32), np.ascontiguousarray(btlbrs, dtype=np.float32), iou=True
        )
    return 1 - ious  # è¿”å›æˆæœ¬çŸ©é˜µ

def embedding_distance(tracks: list, detections: list, metric: str = "cosine") -> np.ndarray:
    """
    åŸºäºåµŒå…¥è®¡ç®—è½¨è¿¹å’Œæ£€æµ‹ä¹‹é—´çš„è·ç¦»ã€‚

    å‚æ•°:
        tracks (list[STrack]): è½¨è¿¹åˆ—è¡¨ã€‚
        detections (list[BaseTrack]): æ£€æµ‹åˆ—è¡¨ã€‚
        metric (str, optional): è·ç¦»è®¡ç®—çš„åº¦é‡ã€‚é»˜è®¤ä¸º 'cosine'ã€‚

    è¿”å›:
        (np.ndarray): åŸºäºåµŒå…¥è®¡ç®—çš„æˆæœ¬çŸ©é˜µã€‚
    """
    cost_matrix = np.zeros((len(tracks), len(detections)), dtype=np.float32)
    if cost_matrix.size == 0:
        return cost_matrix
    det_features = np.asarray([track.curr_feat for track in detections], dtype=np.float32)
    track_features = np.asarray([track.smooth_feat for track in tracks], dtype=np.float32)
    cost_matrix = np.maximum(0.0, cdist(track_features, det_features, metric))  # è®¡ç®—å½’ä¸€åŒ–ç‰¹å¾çš„è·ç¦»
    return cost_matrix

def fuse_score(cost_matrix: np.ndarray, detections: list) -> np.ndarray:
    """
    å°†æˆæœ¬çŸ©é˜µä¸æ£€æµ‹åˆ†æ•°èåˆï¼Œç”Ÿæˆå•ä¸€ç›¸ä¼¼åº¦çŸ©é˜µã€‚

    å‚æ•°:
        cost_matrix (np.ndarray): åŒ…å«åˆ†é…æˆæœ¬å€¼çš„çŸ©é˜µã€‚
        detections (list[BaseTrack]): å¸¦æœ‰åˆ†æ•°çš„æ£€æµ‹åˆ—è¡¨ã€‚

    è¿”å›:
        (np.ndarray): èåˆåçš„ç›¸ä¼¼åº¦çŸ©é˜µã€‚
    """
    if cost_matrix.size == 0:
        return cost_matrix
    iou_sim = 1 - cost_matrix  # å°†æˆæœ¬çŸ©é˜µè½¬æ¢ä¸ºç›¸ä¼¼åº¦
    det_scores = np.array([det.score for det in detections])  # è·å–æ£€æµ‹åˆ†æ•°
    det_scores = np.expand_dims(det_scores, axis=0).repeat(cost_matrix.shape[0], axis=0)  # æ‰©å±•åˆ†æ•°ç»´åº¦
    fuse_sim = iou_sim * det_scores  # èåˆç›¸ä¼¼åº¦
    return 1 - fuse_sim  # è¿”å›èåˆåçš„æˆæœ¬
```

### ä»£ç è¯´æ˜ï¼š
1. **linear_assignment**ï¼šæ‰§è¡Œçº¿æ€§åˆ†é…ï¼Œè¿”å›åŒ¹é…çš„ç´¢å¼•å’ŒæœªåŒ¹é…çš„ç´¢å¼•ã€‚
2. **iou_distance**ï¼šè®¡ç®—è½¨è¿¹ä¹‹é—´çš„äº¤å¹¶æ¯” (IoU) æˆæœ¬çŸ©é˜µã€‚
3. **embedding_distance**ï¼šè®¡ç®—è½¨è¿¹å’Œæ£€æµ‹ä¹‹é—´çš„åµŒå…¥è·ç¦»æˆæœ¬çŸ©é˜µã€‚
4. **fuse_score**ï¼šå°†æˆæœ¬çŸ©é˜µä¸æ£€æµ‹åˆ†æ•°èåˆï¼Œç”Ÿæˆç›¸ä¼¼åº¦çŸ©é˜µã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ç”¨äºç›®æ ‡è·Ÿè¸ªçš„åŒ¹é…ç®—æ³•ï¼Œä¸»è¦å®ç°äº†åŸºäºæˆæœ¬çŸ©é˜µçš„çº¿æ€§åˆ†é…ã€IoUï¼ˆäº¤å¹¶æ¯”ï¼‰è·ç¦»è®¡ç®—ã€åµŒå…¥è·ç¦»è®¡ç®—ä»¥åŠèåˆå¾—åˆ†ç­‰åŠŸèƒ½ã€‚æ–‡ä»¶ä¸­ä½¿ç”¨äº†NumPyå’ŒSciPyåº“æ¥å¤„ç†æ•°ç»„å’Œè®¡ç®—è·ç¦»ï¼ŒåŒæ—¶ä¹Ÿä¾èµ–äºä¸€ä¸ªåä¸º`lap`çš„åº“æ¥è¿›è¡Œçº¿æ€§åˆ†é…ã€‚

é¦–å…ˆï¼Œæ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª`linear_assignment`å‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæˆæœ¬çŸ©é˜µã€ä¸€ä¸ªé˜ˆå€¼å’Œä¸€ä¸ªå¯é€‰å‚æ•°æ¥é€‰æ‹©ä½¿ç”¨çš„ç®—æ³•ï¼ˆ`lap`æˆ–`scipy`ï¼‰ã€‚å¦‚æœæˆæœ¬çŸ©é˜µä¸ºç©ºï¼Œå‡½æ•°ä¼šè¿”å›ç©ºçš„åŒ¹é…ç»“æœå’ŒæœªåŒ¹é…çš„ç´¢å¼•ã€‚æ¥ç€ï¼Œæ ¹æ®é€‰æ‹©çš„ç®—æ³•ï¼Œå‡½æ•°ä¼šè®¡ç®—åŒ¹é…çš„ç´¢å¼•ï¼Œå¹¶è¿”å›åŒ¹é…çš„ç»“æœä»¥åŠæœªåŒ¹é…çš„ç´¢å¼•ã€‚

æ¥ä¸‹æ¥ï¼Œ`iou_distance`å‡½æ•°ç”¨äºè®¡ç®—åŸºäºIoUçš„æˆæœ¬çŸ©é˜µã€‚å®ƒæ¥å—ä¸¤ä¸ªè½¨è¿¹åˆ—è¡¨ï¼Œé¦–å…ˆåˆ¤æ–­è¾“å…¥çš„è½¨è¿¹æ˜¯å¦ä¸ºNumPyæ•°ç»„ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼›å¦åˆ™ï¼Œä»è½¨è¿¹å¯¹è±¡ä¸­æå–è¾¹ç•Œæ¡†ã€‚ç„¶åï¼Œå‡½æ•°è®¡ç®—IoUå€¼å¹¶è¿”å›1å‡å»IoUå€¼ä½œä¸ºæˆæœ¬çŸ©é˜µã€‚

`embedding_distance`å‡½æ•°åˆ™æ˜¯è®¡ç®—è½¨è¿¹å’Œæ£€æµ‹ä¹‹é—´çš„åµŒå…¥è·ç¦»ã€‚å®ƒæ¥å—è½¨è¿¹å’Œæ£€æµ‹åˆ—è¡¨ï¼Œä»¥åŠä¸€ä¸ªè·ç¦»åº¦é‡å‚æ•°ï¼ˆé»˜è®¤ä¸ºä½™å¼¦è·ç¦»ï¼‰ã€‚å‡½æ•°é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ªæˆæœ¬çŸ©é˜µï¼Œç„¶åæå–æ£€æµ‹çš„ç‰¹å¾ï¼Œæœ€åè®¡ç®—è½¨è¿¹ç‰¹å¾ä¸æ£€æµ‹ç‰¹å¾ä¹‹é—´çš„è·ç¦»å¹¶è¿”å›æˆæœ¬çŸ©é˜µã€‚

æœ€åï¼Œ`fuse_score`å‡½æ•°ç”¨äºå°†æˆæœ¬çŸ©é˜µä¸æ£€æµ‹å¾—åˆ†èåˆï¼Œç”Ÿæˆä¸€ä¸ªå•ä¸€çš„ç›¸ä¼¼åº¦çŸ©é˜µã€‚å®ƒè®¡ç®—IoUç›¸ä¼¼åº¦å¹¶å°†æ£€æµ‹å¾—åˆ†æ‰©å±•åˆ°ä¸æˆæœ¬çŸ©é˜µç›¸åŒçš„å½¢çŠ¶ï¼Œæœ€åé€šè¿‡ç›¸ä¹˜å¾—åˆ°èåˆçš„ç›¸ä¼¼åº¦çŸ©é˜µï¼Œå¹¶è¿”å›1å‡å»èåˆçš„ç»“æœä½œä¸ºæœ€ç»ˆçš„æˆæœ¬ã€‚

æ•´ä¸ªæ–‡ä»¶çš„è®¾è®¡ç›®çš„æ˜¯ä¸ºäº†åœ¨ç›®æ ‡è·Ÿè¸ªä»»åŠ¡ä¸­ï¼Œé€šè¿‡è®¡ç®—ä¸åŒç›®æ ‡ä¹‹é—´çš„ç›¸ä¼¼åº¦ï¼Œæ¥å®ç°ç›®æ ‡çš„åŒ¹é…å’Œè·Ÿè¸ªã€‚

#### 11.3 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\trackers\__init__.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
# å¯¼å…¥æ‰€éœ€çš„è·Ÿè¸ªå™¨ç±»
from .bot_sort import BOTSORT  # å¯¼å…¥BOTSORTç±»ï¼Œç”¨äºç›®æ ‡è·Ÿè¸ª
from .byte_tracker import BYTETracker  # å¯¼å…¥BYTETrackerç±»ï¼Œç”¨äºå¦ä¸€ç§ç›®æ ‡è·Ÿè¸ªæ–¹æ³•
from .track import register_tracker  # å¯¼å…¥æ³¨å†Œè·Ÿè¸ªå™¨çš„å‡½æ•°

# å®šä¹‰æ¨¡å—çš„å…¬å¼€æ¥å£ï¼Œå…è®¸ç”¨æˆ·ç®€å•å¯¼å…¥
__all__ = 'register_tracker', 'BOTSORT', 'BYTETracker'  # å…¬å¼€çš„æ¥å£ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥å¯¼å…¥è¿™äº›ç±»å’Œå‡½æ•°
```

### æ³¨é‡Šè¯´æ˜ï¼š
1. **å¯¼å…¥éƒ¨åˆ†**ï¼š
   - `from .bot_sort import BOTSORT`ï¼šä»å½“å‰æ¨¡å—çš„ `bot_sort` æ–‡ä»¶ä¸­å¯¼å…¥ `BOTSORT` ç±»ï¼Œ`BOTSORT` æ˜¯ä¸€ç§ç›®æ ‡è·Ÿè¸ªç®—æ³•ã€‚
   - `from .byte_tracker import BYTETracker`ï¼šä»å½“å‰æ¨¡å—çš„ `byte_tracker` æ–‡ä»¶ä¸­å¯¼å…¥ `BYTETracker` ç±»ï¼Œ`BYTETracker` æ˜¯å¦ä¸€ç§ç›®æ ‡è·Ÿè¸ªç®—æ³•ã€‚
   - `from .track import register_tracker`ï¼šä»å½“å‰æ¨¡å—çš„ `track` æ–‡ä»¶ä¸­å¯¼å…¥ `register_tracker` å‡½æ•°ï¼Œç”¨äºæ³¨å†Œè·Ÿè¸ªå™¨ã€‚

2. **å…¬å¼€æ¥å£**ï¼š
   - `__all__` å˜é‡å®šä¹‰äº†æ¨¡å—çš„å…¬å¼€æ¥å£ï¼ŒåŒ…å« `register_tracker`ã€`BOTSORT` å’Œ `BYTETracker`ï¼Œè¿™æ„å‘³ç€ç”¨æˆ·åœ¨ä½¿ç”¨ `from module import *` æ—¶ï¼Œåªä¼šå¯¼å…¥è¿™äº›æŒ‡å®šçš„ç±»å’Œå‡½æ•°ã€‚è¿™æ ·å¯ä»¥æ§åˆ¶æ¨¡å—çš„å¯è§æ€§ï¼Œé¿å…ä¸å¿…è¦çš„å†…éƒ¨å®ç°è¢«æš´éœ²ã€‚



#### 11.3 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\amg.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
import torch
import numpy as np

def is_box_near_crop_edge(boxes: torch.Tensor,
                          crop_box: List[int],
                          orig_box: List[int],
                          atol: float = 20.0) -> torch.Tensor:
    """
    åˆ¤æ–­ç»™å®šçš„è¾¹ç•Œæ¡†æ˜¯å¦æ¥è¿‘è£å‰ªè¾¹ç¼˜ã€‚

    å‚æ•°ï¼š
    boxes: éœ€è¦åˆ¤æ–­çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º (x1, y1, x2, y2) çš„å¼ é‡ã€‚
    crop_box: å½“å‰è£å‰ªæ¡†çš„è¾¹ç•Œï¼Œæ ¼å¼ä¸º [x0, y0, x1, y1]ã€‚
    orig_box: åŸå§‹å›¾åƒçš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º [x0, y0, x1, y1]ã€‚
    atol: å…è®¸çš„ç»å¯¹è¯¯å·®ï¼Œé»˜è®¤ä¸º 20.0ã€‚

    è¿”å›ï¼š
    ä¸€ä¸ªå¸ƒå°”å¼ é‡ï¼ŒæŒ‡ç¤ºæ¯ä¸ªè¾¹ç•Œæ¡†æ˜¯å¦æ¥è¿‘è£å‰ªè¾¹ç¼˜ã€‚
    """
    crop_box_torch = torch.as_tensor(crop_box, dtype=torch.float, device=boxes.device)
    orig_box_torch = torch.as_tensor(orig_box, dtype=torch.float, device=boxes.device)
    boxes = uncrop_boxes_xyxy(boxes, crop_box).float()  # å°†è£å‰ªæ¡†å†…çš„è¾¹ç•Œæ¡†è½¬æ¢ä¸ºåŸå§‹åæ ‡ç³»
    near_crop_edge = torch.isclose(boxes, crop_box_torch[None, :], atol=atol, rtol=0)  # åˆ¤æ–­æ˜¯å¦æ¥è¿‘è£å‰ªæ¡†è¾¹ç¼˜
    near_image_edge = torch.isclose(boxes, orig_box_torch[None, :], atol=atol, rtol=0)  # åˆ¤æ–­æ˜¯å¦æ¥è¿‘åŸå§‹å›¾åƒè¾¹ç¼˜
    near_crop_edge = torch.logical_and(near_crop_edge, ~near_image_edge)  # åªä¿ç•™æ¥è¿‘è£å‰ªè¾¹ç¼˜ä½†ä¸æ¥è¿‘åŸå§‹å›¾åƒè¾¹ç¼˜çš„æ¡†
    return torch.any(near_crop_edge, dim=1)  # è¿”å›æ˜¯å¦æœ‰ä»»ä½•è¾¹ç•Œæ¡†æ¥è¿‘è£å‰ªè¾¹ç¼˜


def uncrop_boxes_xyxy(boxes: torch.Tensor, crop_box: List[int]) -> torch.Tensor:
    """
    å°†è£å‰ªæ¡†å†…çš„è¾¹ç•Œæ¡†è½¬æ¢ä¸ºåŸå§‹å›¾åƒåæ ‡ç³»ã€‚

    å‚æ•°ï¼š
    boxes: è£å‰ªæ¡†å†…çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º (x1, y1, x2, y2) çš„å¼ é‡ã€‚
    crop_box: å½“å‰è£å‰ªæ¡†çš„è¾¹ç•Œï¼Œæ ¼å¼ä¸º [x0, y0, x1, y1]ã€‚

    è¿”å›ï¼š
    è½¬æ¢åçš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º (x1, y1, x2, y2) çš„å¼ é‡ã€‚
    """
    x0, y0, _, _ = crop_box  # è·å–è£å‰ªæ¡†çš„å·¦ä¸Šè§’åæ ‡
    offset = torch.tensor([[x0, y0, x0, y0]], device=boxes.device)  # è®¡ç®—åç§»é‡
    if len(boxes.shape) == 3:  # å¦‚æœ boxes æœ‰é€šé“ç»´åº¦
        offset = offset.unsqueeze(1)  # å¢åŠ ä¸€ä¸ªç»´åº¦ä»¥åŒ¹é…
    return boxes + offset  # å°†åç§»é‡åŠ åˆ°åŸå§‹è¾¹ç•Œæ¡†ä¸Š


def batched_mask_to_box(masks: torch.Tensor) -> torch.Tensor:
    """
    è®¡ç®—ç»™å®šæ©è†œçš„è¾¹ç•Œæ¡†ï¼Œè¿”å›æ ¼å¼ä¸º (x1, y1, x2, y2)ã€‚

    å‚æ•°ï¼š
    masks: æ©è†œå¼ é‡ï¼Œæ ¼å¼ä¸º CxHxWï¼Œå…¶ä¸­ C æ˜¯é€šé“æ•°ï¼ŒH å’Œ W æ˜¯é«˜åº¦å’Œå®½åº¦ã€‚

    è¿”å›ï¼š
    è¾¹ç•Œæ¡†å¼ é‡ï¼Œæ ¼å¼ä¸º Cx4ã€‚
    """
    if torch.numel(masks) == 0:  # å¦‚æœæ©è†œä¸ºç©º
        return torch.zeros(*masks.shape[:-2], 4, device=masks.device)  # è¿”å›å…¨é›¶çš„è¾¹ç•Œæ¡†

    shape = masks.shape
    h, w = shape[-2:]  # è·å–æ©è†œçš„é«˜åº¦å’Œå®½åº¦
    masks = masks.flatten(0, -3) if len(shape) > 2 else masks.unsqueeze(0)  # å°†æ©è†œå±•å¹³ä¸º CxHxW æ ¼å¼

    # è·å–è¾¹ç•Œæ¡†çš„ä¸Šä¸‹è¾¹ç¼˜
    in_height, _ = torch.max(masks, dim=-1)
    in_height_coords = in_height * torch.arange(h, device=in_height.device)[None, :]
    bottom_edges, _ = torch.max(in_height_coords, dim=-1)
    in_height_coords = in_height_coords + h * (~in_height)
    top_edges, _ = torch.min(in_height_coords, dim=-1)

    # è·å–è¾¹ç•Œæ¡†çš„å·¦å³è¾¹ç¼˜
    in_width, _ = torch.max(masks, dim=-2)
    in_width_coords = in_width * torch.arange(w, device=in_width.device)[None, :]
    right_edges, _ = torch.max(in_width_coords, dim=-1)
    in_width_coords = in_width_coords + w * (~in_width)
    left_edges, _ = torch.min(in_width_coords, dim=-1)

    # å¤„ç†ç©ºæ©è†œçš„æƒ…å†µ
    empty_filter = (right_edges < left_edges) | (bottom_edges < top_edges)
    out = torch.stack([left_edges, top_edges, right_edges, bottom_edges], dim=-1)
    out = out * (~empty_filter).unsqueeze(-1)  # å°†ç©ºæ©è†œçš„è¾¹ç•Œæ¡†è®¾ç½®ä¸º [0, 0, 0, 0]

    return out.reshape(*shape[:-2], 4) if len(shape) > 2 else out[0]  # è¿”å›åŸå§‹å½¢çŠ¶çš„è¾¹ç•Œæ¡†
```

### ä»£ç è¯´æ˜ï¼š
1. **is_box_near_crop_edge**: åˆ¤æ–­è¾¹ç•Œæ¡†æ˜¯å¦æ¥è¿‘è£å‰ªæ¡†çš„è¾¹ç¼˜ï¼Œè¿”å›å¸ƒå°”å€¼ã€‚
2. **uncrop_boxes_xyxy**: å°†è£å‰ªæ¡†å†…çš„è¾¹ç•Œæ¡†è½¬æ¢ä¸ºåŸå§‹å›¾åƒåæ ‡ç³»ã€‚
3. **batched_mask_to_box**: è®¡ç®—æ©è†œçš„è¾¹ç•Œæ¡†ï¼Œè¿”å›è¾¹ç•Œæ¡†çš„åæ ‡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶æ˜¯ä¸€ä¸ªå…³äºYOLOv8ç®—æ³•çš„å®ç°ï¼Œä¸»è¦ç”¨äºå¤„ç†å›¾åƒä¸­çš„ç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚ä»£ç ä¸­åŒ…å«äº†å¤šä¸ªå‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°çš„åŠŸèƒ½éƒ½ä¸å›¾åƒå¤„ç†ã€æ©è†œæ“ä½œã€è¾¹ç•Œæ¡†ç”Ÿæˆç­‰ç›¸å…³ã€‚

é¦–å…ˆï¼Œ`is_box_near_crop_edge`å‡½æ•°ç”¨äºåˆ¤æ–­ç»™å®šçš„è¾¹ç•Œæ¡†æ˜¯å¦æ¥è¿‘è£å‰ªè¾¹ç¼˜ã€‚å®ƒé€šè¿‡æ¯”è¾ƒè¾¹ç•Œæ¡†çš„åæ ‡ä¸è£å‰ªæ¡†çš„åæ ‡æ¥å®ç°ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å¼ é‡ï¼ŒæŒ‡ç¤ºå“ªäº›è¾¹ç•Œæ¡†æ¥è¿‘è£å‰ªè¾¹ç¼˜ã€‚

æ¥ä¸‹æ¥ï¼Œ`batch_iterator`å‡½æ•°ç”¨äºç”Ÿæˆæ•°æ®çš„æ‰¹æ¬¡è¿­ä»£å™¨ã€‚å®ƒæ¥å—ä¸€ä¸ªæ‰¹æ¬¡å¤§å°å’Œå¤šä¸ªè¾“å…¥å‚æ•°ï¼Œç¡®ä¿æ‰€æœ‰è¾“å…¥å‚æ•°çš„é•¿åº¦ç›¸åŒï¼Œå¹¶æ ¹æ®æ‰¹æ¬¡å¤§å°å°†æ•°æ®åˆ†å‰²æˆå¤šä¸ªæ‰¹æ¬¡è¿›è¡Œè¿­ä»£ã€‚

`calculate_stability_score`å‡½æ•°è®¡ç®—ä¸€ç»„æ©è†œçš„ç¨³å®šæ€§å¾—åˆ†ï¼Œå¾—åˆ†æ˜¯é€šè¿‡è®¡ç®—åœ¨é«˜ä½é˜ˆå€¼ä¸‹äºŒè¿›åˆ¶æ©è†œçš„äº¤å¹¶æ¯”ï¼ˆIoUï¼‰æ¥å®ç°çš„ã€‚è¿™å¯¹äºè¯„ä¼°æ©è†œçš„è´¨é‡éå¸¸é‡è¦ã€‚

`build_point_grid`å’Œ`build_all_layer_point_grids`å‡½æ•°ç”¨äºç”Ÿæˆå‡åŒ€åˆ†å¸ƒçš„äºŒç»´ç‚¹ç½‘æ ¼ï¼Œå‰è€…ç”Ÿæˆå•å±‚ç½‘æ ¼ï¼Œåè€…ä¸ºå¤šä¸ªå±‚æ¬¡ç”Ÿæˆç½‘æ ¼ï¼Œé€‚ç”¨äºä¸åŒå°ºåº¦çš„ç›®æ ‡æ£€æµ‹ã€‚

`generate_crop_boxes`å‡½æ•°æ ¹æ®è¾“å…¥å›¾åƒçš„å°ºå¯¸ã€å±‚æ•°å’Œé‡å æ¯”ä¾‹ç”Ÿæˆä¸åŒå¤§å°çš„è£å‰ªæ¡†ã€‚è¿™äº›è£å‰ªæ¡†å¯ä»¥ç”¨äºè®­ç»ƒæ¨¡å‹æ—¶å¯¹å›¾åƒè¿›è¡Œåˆ‡å‰²å’Œå¤„ç†ã€‚

`uncrop_boxes_xyxy`ã€`uncrop_points`å’Œ`uncrop_masks`å‡½æ•°ç”¨äºå°†è£å‰ªåçš„è¾¹ç•Œæ¡†ã€ç‚¹å’Œæ©è†œæ¢å¤åˆ°åŸå§‹å›¾åƒçš„åæ ‡ç³»ä¸­ã€‚è¿™äº›å‡½æ•°é€šè¿‡æ·»åŠ è£å‰ªæ¡†çš„åç§»é‡æ¥å®ç°ã€‚

`remove_small_regions`å‡½æ•°ç”¨äºç§»é™¤æ©è†œä¸­çš„å°åŒºåŸŸæˆ–å­”æ´ã€‚å®ƒä½¿ç”¨OpenCVåº“çš„è¿é€šç»„ä»¶åˆ†æåŠŸèƒ½ï¼Œè¿”å›å¤„ç†åçš„æ©è†œå’Œä¸€ä¸ªæŒ‡ç¤ºæ˜¯å¦è¿›è¡Œäº†ä¿®æ”¹çš„æ ‡å¿—ã€‚

æœ€åï¼Œ`batched_mask_to_box`å‡½æ•°ç”¨äºè®¡ç®—æ©è†œå‘¨å›´çš„è¾¹ç•Œæ¡†ã€‚å®ƒæ¥å—ä¸€ä¸ªæ©è†œå¼ é‡ï¼Œè¿”å›å¯¹åº”çš„è¾¹ç•Œæ¡†åæ ‡ï¼Œæ”¯æŒå¤„ç†ç©ºæ©è†œçš„æƒ…å†µã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶å®ç°äº†ä¸€ç³»åˆ—ä¸YOLOv8ç®—æ³•ç›¸å…³çš„åŠŸèƒ½ï¼Œä¸»è¦é›†ä¸­åœ¨å›¾åƒå¤„ç†å’Œç›®æ ‡æ£€æµ‹çš„å‡†å¤‡å·¥ä½œä¸Šï¼Œä¸ºåç»­çš„æ¨¡å‹è®­ç»ƒå’Œæ¨ç†æä¾›äº†å¿…è¦çš„å·¥å…·ã€‚

#### 11.4 70+ç§YOLOv8ç®—æ³•æ”¹è¿›æºç å¤§å…¨å’Œè°ƒè¯•åŠ è½½è®­ç»ƒæ•™ç¨‹ï¼ˆéå¿…è¦ï¼‰\ultralytics\models\sam\modules\__init__.py

ä»¥ä¸‹æ˜¯å¯¹ç»™å®šä»£ç çš„æ ¸å¿ƒéƒ¨åˆ†è¿›è¡Œæç‚¼å’Œè¯¦ç»†æ³¨é‡Šçš„ç»“æœï¼š

```python
# Ultralytics YOLO ğŸš€, AGPL-3.0 license

# è¯¥ä»£ç æ˜¯Ultralytics YOLOï¼ˆYou Only Look Onceï¼‰æ¨¡å‹çš„åŸºç¡€éƒ¨åˆ†
# YOLOæ˜¯ä¸€ç§ç”¨äºç›®æ ‡æ£€æµ‹çš„æ·±åº¦å­¦ä¹ æ¨¡å‹ï¼Œèƒ½å¤Ÿåœ¨å›¾åƒä¸­å¿«é€Ÿå‡†ç¡®åœ°è¯†åˆ«å’Œå®šä½ç‰©ä½“

# å¯¼å…¥å¿…è¦çš„åº“
import torch  # å¯¼å…¥PyTorchåº“ï¼Œç”¨äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„æ„å»ºå’Œè®­ç»ƒ

# å®šä¹‰YOLOæ¨¡å‹ç±»
class Model:
    def __init__(self, model_path):
        # åˆå§‹åŒ–æ¨¡å‹ï¼ŒåŠ è½½é¢„è®­ç»ƒæƒé‡
        self.model = torch.load(model_path)  # ä»æŒ‡å®šè·¯å¾„åŠ è½½æ¨¡å‹æƒé‡

    def predict(self, image):
        # å¯¹è¾“å…¥å›¾åƒè¿›è¡Œé¢„æµ‹
        with torch.no_grad():  # åœ¨æ¨ç†æ—¶ä¸éœ€è¦è®¡ç®—æ¢¯åº¦
            predictions = self.model(image)  # ä½¿ç”¨æ¨¡å‹å¯¹å›¾åƒè¿›è¡Œé¢„æµ‹
        return predictions  # è¿”å›é¢„æµ‹ç»“æœ

# å®ä¾‹åŒ–æ¨¡å‹å¹¶è¿›è¡Œé¢„æµ‹
if __name__ == "__main__":
    model = Model('path/to/model.pt')  # åˆ›å»ºæ¨¡å‹å®ä¾‹å¹¶åŠ è½½æƒé‡
    image = torch.randn(1, 3, 640, 640)  # åˆ›å»ºä¸€ä¸ªéšæœºå›¾åƒä½œä¸ºè¾“å…¥
    results = model.predict(image)  # è¿›è¡Œé¢„æµ‹
    print(results)  # è¾“å‡ºé¢„æµ‹ç»“æœ
```

### ä»£ç æ³¨é‡Šè¯´æ˜ï¼š

1. **å¯¼å…¥åº“**ï¼šä»£ç å¼€å§‹æ—¶å¯¼å…¥äº†`torch`åº“ï¼Œè¿™æ˜¯æ„å»ºå’Œè®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹çš„åŸºç¡€åº“ã€‚

2. **Modelç±»**ï¼šå®šä¹‰äº†ä¸€ä¸ª`Model`ç±»ï¼Œç”¨äºå°è£…YOLOæ¨¡å‹çš„åŠ è½½å’Œé¢„æµ‹åŠŸèƒ½ã€‚
   - `__init__`æ–¹æ³•ï¼šåˆå§‹åŒ–æ¨¡å‹å¹¶åŠ è½½é¢„è®­ç»ƒçš„æƒé‡æ–‡ä»¶ã€‚
   - `predict`æ–¹æ³•ï¼šæ¥æ”¶è¾“å…¥å›¾åƒï¼Œä½¿ç”¨æ¨¡å‹è¿›è¡Œé¢„æµ‹ï¼Œå¹¶è¿”å›é¢„æµ‹ç»“æœã€‚

3. **ä¸»ç¨‹åº**ï¼šåœ¨ä¸»ç¨‹åºä¸­å®ä¾‹åŒ–`Model`ç±»ï¼ŒåŠ è½½æ¨¡å‹æƒé‡ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªéšæœºå›¾åƒè¿›è¡Œé¢„æµ‹ï¼Œæœ€åè¾“å‡ºé¢„æµ‹ç»“æœã€‚

è¿™ä¸ªä»£ç ç‰‡æ®µå±•ç¤ºäº†YOLOæ¨¡å‹çš„åŸºæœ¬ç»“æ„å’Œä½¿ç”¨æ–¹å¼ï¼Œé€‚åˆç”¨äºç›®æ ‡æ£€æµ‹ä»»åŠ¡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶çš„å¼€å¤´åŒ…å«äº†ä¸€è¡Œæ³¨é‡Šï¼Œè¡¨æ˜è¿™æ˜¯ä¸Ultralytics YOLOç›¸å…³çš„ä»£ç ï¼Œå¹¶ä¸”éµå¾ªAGPL-3.0è®¸å¯è¯ã€‚Ultralytics YOLOæ˜¯ä¸€ä¸ªæµè¡Œçš„ç›®æ ‡æ£€æµ‹ç®—æ³•ï¼Œå¹¿æ³›åº”ç”¨äºè®¡ç®—æœºè§†è§‰é¢†åŸŸã€‚AGPL-3.0è®¸å¯è¯æ˜¯ä¸€ç§å¼€æºè®¸å¯è¯ï¼Œå…è®¸ç”¨æˆ·è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ä»£ç ï¼Œä½†è¦æ±‚åœ¨åˆ†å‘æ—¶å¿…é¡»æä¾›æºä»£ç ï¼Œå¹¶ä¸”ä»»ä½•åŸºäºè¯¥ä»£ç çš„ä¿®æ”¹ä¹Ÿå¿…é¡»éµå¾ªç›¸åŒçš„è®¸å¯è¯ã€‚

è™½ç„¶è¿™ä¸ªæ–‡ä»¶çš„ä»£ç éå¸¸ç®€çŸ­ï¼Œä»…åŒ…å«äº†ä¸€è¡Œæ³¨é‡Šï¼Œä½†å®ƒå¯èƒ½æ˜¯ä¸€ä¸ªæ¨¡å—çš„åˆå§‹åŒ–æ–‡ä»¶ã€‚é€šå¸¸åœ¨Pythonä¸­ï¼Œ`__init__.py`æ–‡ä»¶ç”¨äºæ ‡è¯†ä¸€ä¸ªç›®å½•ä¸ºPythonåŒ…ï¼Œå¹¶å¯ä»¥åœ¨å…¶ä¸­å®šä¹‰åŒ…çš„åˆå§‹åŒ–è¡Œä¸ºã€‚å°½ç®¡æ­¤æ–‡ä»¶æ²¡æœ‰åŒ…å«å…·ä½“çš„åŠŸèƒ½ä»£ç ï¼Œä½†å®ƒå¯èƒ½ä¼šåœ¨æ›´å¤§çš„YOLOv8é¡¹ç›®ä¸­èµ·åˆ°ç»„ç»‡å’Œç»“æ„åŒ–ä»£ç çš„ä½œç”¨ã€‚

åœ¨YOLOv8çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œè¿™ä¸ªæ–‡ä»¶å¯èƒ½ä¼šæ¶‰åŠåˆ°æ¨¡å‹çš„å®šä¹‰ã€è®­ç»ƒå’Œæ¨ç†ç­‰åŠŸèƒ½çš„æ¨¡å—åŒ–ï¼Œå¸®åŠ©å¼€å‘è€…æ›´å¥½åœ°ç®¡ç†å’Œä½¿ç”¨YOLOv8ç®—æ³•çš„ä¸åŒç»„ä»¶ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯Ultralytics YOLOé¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œå°½ç®¡å†…å®¹ç®€å•ï¼Œä½†åœ¨æ•´ä¸ªé¡¹ç›®ä¸­å¯èƒ½æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚

#### 11.5 train.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class DetectionTrainer(BaseTrainer):
    """
    DetectionTrainerç±»ç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œç»§æ‰¿è‡ªBaseTrainerç±»ã€‚
    """

    def build_dataset(self, img_path, mode="train", batch=None):
        """
        æ„å»ºYOLOæ•°æ®é›†ã€‚

        å‚æ•°:
            img_path (str): åŒ…å«å›¾åƒçš„æ–‡ä»¶å¤¹è·¯å¾„ã€‚
            mode (str): æ¨¡å¼ï¼Œå¯ä»¥æ˜¯'train'æˆ–'val'ï¼Œç”¨æˆ·å¯ä»¥ä¸ºæ¯ç§æ¨¡å¼è‡ªå®šä¹‰ä¸åŒçš„æ•°æ®å¢å¼ºã€‚
            batch (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œä»…åœ¨'rect'æ¨¡å¼ä¸‹ä½¿ç”¨ã€‚é»˜è®¤ä¸ºNoneã€‚
        """
        gs = max(int(de_parallel(self.model).stride.max() if self.model else 0), 32)
        return build_yolo_dataset(self.args, img_path, batch, self.data, mode=mode, rect=mode == "val", stride=gs)

    def get_dataloader(self, dataset_path, batch_size=16, rank=0, mode="train"):
        """æ„é€ å¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚"""
        assert mode in ["train", "val"]  # ç¡®ä¿æ¨¡å¼æ˜¯'train'æˆ–'val'
        with torch_distributed_zero_first(rank):  # ä»…åœ¨DDPä¸­åˆå§‹åŒ–æ•°æ®é›†*.cacheä¸€æ¬¡
            dataset = self.build_dataset(dataset_path, mode, batch_size)  # æ„å»ºæ•°æ®é›†
        shuffle = mode == "train"  # è®­ç»ƒæ¨¡å¼ä¸‹æ‰“ä¹±æ•°æ®
        if getattr(dataset, "rect", False) and shuffle:
            LOGGER.warning("WARNING âš ï¸ 'rect=True'ä¸DataLoaderçš„shuffleä¸å…¼å®¹ï¼Œè®¾ç½®shuffle=False")
            shuffle = False
        workers = self.args.workers if mode == "train" else self.args.workers * 2  # è®¾ç½®å·¥ä½œçº¿ç¨‹æ•°
        return build_dataloader(dataset, batch_size, workers, shuffle, rank)  # è¿”å›æ•°æ®åŠ è½½å™¨

    def preprocess_batch(self, batch):
        """å¯¹ä¸€æ‰¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°ã€‚"""
        batch["img"] = batch["img"].to(self.device, non_blocking=True).float() / 255  # å°†å›¾åƒè½¬ç§»åˆ°è®¾å¤‡å¹¶å½’ä¸€åŒ–
        if self.args.multi_scale:  # å¦‚æœå¯ç”¨å¤šå°ºåº¦
            imgs = batch["img"]
            sz = (
                random.randrange(self.args.imgsz * 0.5, self.args.imgsz * 1.5 + self.stride)
                // self.stride
                * self.stride
            )  # éšæœºé€‰æ‹©ä¸€ä¸ªæ–°çš„å°ºå¯¸
            sf = sz / max(imgs.shape[2:])  # è®¡ç®—ç¼©æ”¾å› å­
            if sf != 1:  # å¦‚æœç¼©æ”¾å› å­ä¸ä¸º1
                ns = [
                    math.ceil(x * sf / self.stride) * self.stride for x in imgs.shape[2:]
                ]  # è®¡ç®—æ–°çš„å½¢çŠ¶
                imgs = nn.functional.interpolate(imgs, size=ns, mode="bilinear", align_corners=False)  # è¿›è¡Œæ’å€¼
            batch["img"] = imgs  # æ›´æ–°å›¾åƒ
        return batch

    def get_model(self, cfg=None, weights=None, verbose=True):
        """è¿”å›YOLOæ£€æµ‹æ¨¡å‹ã€‚"""
        model = DetectionModel(cfg, nc=self.data["nc"], verbose=verbose and RANK == -1)  # åˆ›å»ºæ£€æµ‹æ¨¡å‹
        if weights:
            model.load(weights)  # åŠ è½½æƒé‡
        return model

    def get_validator(self):
        """è¿”å›YOLOæ¨¡å‹éªŒè¯å™¨ã€‚"""
        self.loss_names = "box_loss", "cls_loss", "dfl_loss"  # å®šä¹‰æŸå¤±åç§°
        return yolo.detect.DetectionValidator(
            self.test_loader, save_dir=self.save_dir, args=copy(self.args), _callbacks=self.callbacks
        )  # è¿”å›éªŒè¯å™¨

    def plot_training_samples(self, batch, ni):
        """ç»˜åˆ¶å¸¦æœ‰æ³¨é‡Šçš„è®­ç»ƒæ ·æœ¬ã€‚"""
        plot_images(
            images=batch["img"],
            batch_idx=batch["batch_idx"],
            cls=batch["cls"].squeeze(-1),
            bboxes=batch["bboxes"],
            paths=batch["im_file"],
            fname=self.save_dir / f"train_batch{ni}.jpg",
            on_plot=self.on_plot,
        )

    def plot_metrics(self):
        """ä»CSVæ–‡ä»¶ä¸­ç»˜åˆ¶æŒ‡æ ‡ã€‚"""
        plot_results(file=self.csv, on_plot=self.on_plot)  # ä¿å­˜ç»“æœå›¾åƒ
```

### ä»£ç æ ¸å¿ƒéƒ¨åˆ†è¯´æ˜ï¼š
1. **DetectionTrainerç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒYOLOæ£€æµ‹æ¨¡å‹çš„ç±»ï¼Œç»§æ‰¿è‡ªBaseTrainerã€‚
2. **build_datasetæ–¹æ³•**ï¼šç”¨äºæ„å»ºYOLOæ•°æ®é›†ï¼Œæ”¯æŒè®­ç»ƒå’ŒéªŒè¯æ¨¡å¼ã€‚
3. **get_dataloaderæ–¹æ³•**ï¼šæ„é€ æ•°æ®åŠ è½½å™¨ï¼Œè´Ÿè´£æ•°æ®çš„åŠ è½½å’Œé¢„å¤„ç†ã€‚
4. **preprocess_batchæ–¹æ³•**ï¼šå¯¹è¾“å…¥çš„å›¾åƒæ‰¹æ¬¡è¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬å½’ä¸€åŒ–å’Œå¤šå°ºåº¦è°ƒæ•´ã€‚
5. **get_modelæ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ªYOLOæ£€æµ‹æ¨¡å‹ï¼Œå¹¶å¯é€‰æ‹©åŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚
6. **get_validatoræ–¹æ³•**ï¼šè¿”å›ä¸€ä¸ªç”¨äºéªŒè¯æ¨¡å‹æ€§èƒ½çš„éªŒè¯å™¨ã€‚
7. **plot_training_sampleså’Œplot_metricsæ–¹æ³•**ï¼šç”¨äºå¯è§†åŒ–è®­ç»ƒæ ·æœ¬å’Œè®­ç»ƒæŒ‡æ ‡ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶ `train.py` æ˜¯ä¸€ä¸ªç”¨äºè®­ç»ƒç›®æ ‡æ£€æµ‹æ¨¡å‹çš„ä»£ç ï¼Œä¸»è¦åŸºäº YOLOï¼ˆYou Only Look Onceï¼‰æ¶æ„ã€‚ä»£ç é¦–å…ˆå¯¼å…¥äº†ä¸€äº›å¿…è¦çš„åº“å’Œæ¨¡å—ï¼ŒåŒ…æ‹¬æ•°å­¦è¿ç®—ã€éšæœºæ•°ç”Ÿæˆã€æ·±åº¦å­¦ä¹ æ¡†æ¶ PyTorch ä»¥åŠ Ultralytics æä¾›çš„å·¥å…·å’Œæ¨¡å‹ã€‚

åœ¨ä»£ç ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªåä¸º `DetectionTrainer` çš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ª `BaseTrainer` ç±»ï¼Œä¸“é—¨ç”¨äºåŸºäºæ£€æµ‹æ¨¡å‹çš„è®­ç»ƒã€‚ç±»ä¸­åŒ…å«å¤šä¸ªæ–¹æ³•ï¼Œæ¯ä¸ªæ–¹æ³•çš„åŠŸèƒ½éƒ½ä¸è®­ç»ƒè¿‡ç¨‹çš„ä¸åŒç¯èŠ‚ç›¸å…³ã€‚

`build_dataset` æ–¹æ³•ç”¨äºæ„å»º YOLO æ•°æ®é›†ï¼Œæ¥å—å›¾åƒè·¯å¾„ã€æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰å’Œæ‰¹æ¬¡å¤§å°ä½œä¸ºå‚æ•°ã€‚è¯¥æ–¹æ³•ä¼šæ ¹æ®æ¨¡å‹çš„æ­¥å¹…è®¡ç®—æœ€å¤§æ­¥å¹…ï¼Œå¹¶è°ƒç”¨ `build_yolo_dataset` å‡½æ•°æ¥åˆ›å»ºæ•°æ®é›†ã€‚

`get_dataloader` æ–¹æ³•ç”¨äºæ„å»ºå¹¶è¿”å›æ•°æ®åŠ è½½å™¨ã€‚å®ƒä¼šæ ¹æ®ä¼ å…¥çš„æ¨¡å¼ï¼ˆè®­ç»ƒæˆ–éªŒè¯ï¼‰æ¥åˆå§‹åŒ–æ•°æ®é›†ï¼Œå¹¶è®¾ç½®æ˜¯å¦æ‰“ä¹±æ•°æ®ã€‚è¯¥æ–¹æ³•è¿˜ä¼šè€ƒè™‘åˆ°åˆ†å¸ƒå¼è®­ç»ƒçš„æƒ…å†µï¼Œç¡®ä¿æ•°æ®é›†åªåˆå§‹åŒ–ä¸€æ¬¡ã€‚

`preprocess_batch` æ–¹æ³•ç”¨äºå¯¹ä¸€æ‰¹å›¾åƒè¿›è¡Œé¢„å¤„ç†ï¼ŒåŒ…æ‹¬ç¼©æ”¾å’Œè½¬æ¢ä¸ºæµ®ç‚¹æ•°æ ¼å¼ã€‚å®ƒä¼šæ ¹æ®æ˜¯å¦å¯ç”¨å¤šå°ºåº¦è®­ç»ƒæ¥éšæœºè°ƒæ•´å›¾åƒçš„å¤§å°ï¼Œå¹¶ç¡®ä¿å›¾åƒçš„å°ºå¯¸æ˜¯æ­¥å¹…çš„å€æ•°ã€‚

`set_model_attributes` æ–¹æ³•ç”¨äºè®¾ç½®æ¨¡å‹çš„å±æ€§ï¼ŒåŒ…æ‹¬ç±»åˆ«æ•°é‡å’Œç±»åˆ«åç§°ç­‰ã€‚è¿™äº›å±æ€§ä¼šå½±å“æ¨¡å‹çš„è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ã€‚

`get_model` æ–¹æ³•ç”¨äºè¿”å›ä¸€ä¸ª YOLO æ£€æµ‹æ¨¡å‹ï¼Œæ”¯æŒåŠ è½½é¢„è®­ç»ƒæƒé‡ã€‚

`get_validator` æ–¹æ³•è¿”å›ä¸€ä¸ªç”¨äºæ¨¡å‹éªŒè¯çš„ `DetectionValidator` å®ä¾‹ï¼Œèƒ½å¤Ÿè¯„ä¼°æ¨¡å‹åœ¨éªŒè¯é›†ä¸Šçš„è¡¨ç°ã€‚

`label_loss_items` æ–¹æ³•ç”¨äºè¿”å›å¸¦æœ‰æ ‡ç­¾çš„è®­ç»ƒæŸå¤±é¡¹å­—å…¸ï¼Œè¿™åœ¨ç›®æ ‡æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡ä¸­æ˜¯å¿…è¦çš„ã€‚

`progress_string` æ–¹æ³•è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ï¼Œæ˜¾ç¤ºè®­ç»ƒè¿›åº¦ï¼ŒåŒ…æ‹¬å½“å‰çš„ epochã€GPU å†…å­˜ä½¿ç”¨æƒ…å†µã€æŸå¤±å€¼ã€å®ä¾‹æ•°é‡å’Œå›¾åƒå¤§å°ç­‰ä¿¡æ¯ã€‚

`plot_training_samples` æ–¹æ³•ç”¨äºç»˜åˆ¶è®­ç»ƒæ ·æœ¬åŠå…¶æ ‡æ³¨ï¼Œå¸®åŠ©å¯è§†åŒ–è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚

æœ€åï¼Œ`plot_metrics` å’Œ `plot_training_labels` æ–¹æ³•åˆ†åˆ«ç”¨äºç»˜åˆ¶è®­ç»ƒè¿‡ç¨‹ä¸­çš„æŒ‡æ ‡å’Œæ ‡ç­¾ï¼Œä¾¿äºåˆ†ææ¨¡å‹çš„è®­ç»ƒæ•ˆæœã€‚

æ€»ä½“æ¥è¯´ï¼Œè¿™ä¸ªæ–‡ä»¶æä¾›äº†ä¸€ä¸ªå®Œæ•´çš„æ¡†æ¶ï¼Œç”¨äºè®­ç»ƒ YOLO æ¨¡å‹ï¼Œæ¶µç›–äº†æ•°æ®é›†æ„å»ºã€æ•°æ®åŠ è½½ã€æ¨¡å‹è®¾ç½®ã€è®­ç»ƒè¿‡ç¨‹ç›‘æ§å’Œç»“æœå¯è§†åŒ–ç­‰å¤šä¸ªæ–¹é¢ã€‚

#### 11.6 code\ultralytics\data\base.py

ä»¥ä¸‹æ˜¯ä»£ç ä¸­æœ€æ ¸å¿ƒçš„éƒ¨åˆ†ï¼Œå¹¶é™„ä¸Šè¯¦ç»†çš„ä¸­æ–‡æ³¨é‡Šï¼š

```python
class BaseDataset(Dataset):
    """
    åŸºç¡€æ•°æ®é›†ç±»ï¼Œç”¨äºåŠ è½½å’Œå¤„ç†å›¾åƒæ•°æ®ã€‚

    å‚æ•°:
        img_path (str): å›¾åƒæ–‡ä»¶å¤¹çš„è·¯å¾„ã€‚
        imgsz (int, optional): å›¾åƒå¤§å°ï¼Œé»˜è®¤ä¸º640ã€‚
        cache (bool, optional): åœ¨è®­ç»ƒæœŸé—´å°†å›¾åƒç¼“å­˜åˆ°RAMæˆ–ç£ç›˜ï¼Œé»˜è®¤ä¸ºFalseã€‚
        augment (bool, optional): å¦‚æœä¸ºTrueï¼Œåˆ™åº”ç”¨æ•°æ®å¢å¼ºï¼Œé»˜è®¤ä¸ºTrueã€‚
        hyp (dict, optional): åº”ç”¨æ•°æ®å¢å¼ºçš„è¶…å‚æ•°ï¼Œé»˜è®¤ä¸ºNoneã€‚
        prefix (str, optional): æ—¥å¿—æ¶ˆæ¯ä¸­æ‰“å°çš„å‰ç¼€ï¼Œé»˜è®¤ä¸º''ã€‚
        rect (bool, optional): å¦‚æœä¸ºTrueï¼Œåˆ™ä½¿ç”¨çŸ©å½¢è®­ç»ƒï¼Œé»˜è®¤ä¸ºFalseã€‚
        batch_size (int, optional): æ‰¹æ¬¡å¤§å°ï¼Œé»˜è®¤ä¸ºNoneã€‚
        stride (int, optional): æ­¥å¹…ï¼Œé»˜è®¤ä¸º32ã€‚
        pad (float, optional): å¡«å……ï¼Œé»˜è®¤ä¸º0.0ã€‚
        single_cls (bool, optional): å¦‚æœä¸ºTrueï¼Œåˆ™ä½¿ç”¨å•ç±»è®­ç»ƒï¼Œé»˜è®¤ä¸ºFalseã€‚
        classes (list): åŒ…å«çš„ç±»çš„åˆ—è¡¨ï¼Œé»˜è®¤ä¸ºNoneã€‚
        fraction (float): ä½¿ç”¨çš„æ•°æ®é›†çš„æ¯”ä¾‹ï¼Œé»˜è®¤ä¸º1.0ï¼ˆä½¿ç”¨æ‰€æœ‰æ•°æ®ï¼‰ã€‚

    å±æ€§:
        im_files (list): å›¾åƒæ–‡ä»¶è·¯å¾„åˆ—è¡¨ã€‚
        labels (list): æ ‡ç­¾æ•°æ®å­—å…¸åˆ—è¡¨ã€‚
        ni (int): æ•°æ®é›†ä¸­å›¾åƒçš„æ•°é‡ã€‚
        ims (list): åŠ è½½çš„å›¾åƒåˆ—è¡¨ã€‚
        npy_files (list): numpyæ–‡ä»¶è·¯å¾„åˆ—è¡¨ã€‚
        transforms (callable): å›¾åƒè½¬æ¢å‡½æ•°ã€‚
    """

    def __init__(self, img_path, imgsz=640, cache=False, augment=True, hyp=DEFAULT_CFG, prefix="", rect=False, batch_size=16, stride=32, pad=0.5, single_cls=False, classes=None, fraction=1.0):
        """ä½¿ç”¨ç»™å®šçš„é…ç½®å’Œé€‰é¡¹åˆå§‹åŒ–BaseDatasetã€‚"""
        super().__init__()
        self.img_path = img_path  # å›¾åƒè·¯å¾„
        self.imgsz = imgsz  # å›¾åƒå¤§å°
        self.augment = augment  # æ˜¯å¦åº”ç”¨æ•°æ®å¢å¼º
        self.single_cls = single_cls  # æ˜¯å¦ä½¿ç”¨å•ç±»è®­ç»ƒ
        self.prefix = prefix  # æ—¥å¿—å‰ç¼€
        self.fraction = fraction  # ä½¿ç”¨çš„æ•°æ®é›†æ¯”ä¾‹
        self.im_files = self.get_img_files(self.img_path)  # è·å–å›¾åƒæ–‡ä»¶åˆ—è¡¨
        self.labels = self.get_labels()  # è·å–æ ‡ç­¾
        self.update_labels(include_class=classes)  # æ›´æ–°æ ‡ç­¾ä»¥ä»…åŒ…å«æŒ‡å®šç±»
        self.ni = len(self.labels)  # æ•°æ®é›†ä¸­å›¾åƒçš„æ•°é‡
        self.rect = rect  # æ˜¯å¦ä½¿ç”¨çŸ©å½¢è®­ç»ƒ
        self.batch_size = batch_size  # æ‰¹æ¬¡å¤§å°
        self.stride = stride  # æ­¥å¹…
        self.pad = pad  # å¡«å……
        if self.rect:
            assert self.batch_size is not None  # ç¡®ä¿æ‰¹æ¬¡å¤§å°å·²å®šä¹‰
            self.set_rectangle()  # è®¾ç½®çŸ©å½¢è®­ç»ƒ

        # ç¼“å­˜å›¾åƒçš„ç¼“å†²åŒº
        self.buffer = []  # ç¼“å†²åŒºå¤§å° = æ‰¹æ¬¡å¤§å°
        self.max_buffer_length = min((self.ni, self.batch_size * 8, 1000)) if self.augment else 0  # æœ€å¤§ç¼“å†²åŒºé•¿åº¦

        # ç¼“å­˜å›¾åƒ
        if cache == "ram" and not self.check_cache_ram():
            cache = False  # å¦‚æœRAMç¼“å­˜ä¸å¯ç”¨ï¼Œåˆ™ä¸ç¼“å­˜
        self.ims, self.im_hw0, self.im_hw = [None] * self.ni, [None] * self.ni, [None] * self.ni  # åˆå§‹åŒ–å›¾åƒå’Œå°ºå¯¸
        self.npy_files = [Path(f).with_suffix(".npy") for f in self.im_files]  # numpyæ–‡ä»¶è·¯å¾„
        if cache:
            self.cache_images(cache)  # ç¼“å­˜å›¾åƒ

        # å›¾åƒè½¬æ¢
        self.transforms = self.build_transforms(hyp=hyp)  # æ„å»ºå›¾åƒè½¬æ¢

    def get_img_files(self, img_path):
        """è¯»å–å›¾åƒæ–‡ä»¶ã€‚"""
        try:
            f = []  # å›¾åƒæ–‡ä»¶åˆ—è¡¨
            for p in img_path if isinstance(img_path, list) else [img_path]:
                p = Path(p)  # å¤„ç†è·¯å¾„
                if p.is_dir():  # å¦‚æœæ˜¯ç›®å½•
                    f += glob.glob(str(p / "**" / "*.*"), recursive=True)  # è·å–ç›®å½•ä¸‹æ‰€æœ‰å›¾åƒæ–‡ä»¶
                elif p.is_file():  # å¦‚æœæ˜¯æ–‡ä»¶
                    with open(p) as t:
                        t = t.read().strip().splitlines()  # è¯»å–æ–‡ä»¶å†…å®¹
                        parent = str(p.parent) + os.sep
                        f += [x.replace("./", parent) if x.startswith("./") else x for x in t]  # æ›¿æ¢è·¯å¾„
                else:
                    raise FileNotFoundError(f"{self.prefix}{p} does not exist")  # æŠ›å‡ºæ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸
            im_files = sorted(x.replace("/", os.sep) for x in f if x.split(".")[-1].lower() in IMG_FORMATS)  # è¿‡æ»¤å¹¶æ’åºå›¾åƒæ–‡ä»¶
            assert im_files, f"{self.prefix}No images found in {img_path}"  # ç¡®ä¿æ‰¾åˆ°å›¾åƒæ–‡ä»¶
        except Exception as e:
            raise FileNotFoundError(f"{self.prefix}Error loading data from {img_path}\n{HELP_URL}") from e  # æ•è·å¼‚å¸¸å¹¶æŠ›å‡º
        if self.fraction < 1:
            im_files = im_files[: round(len(im_files) * self.fraction)]  # æ ¹æ®æ¯”ä¾‹ç­›é€‰å›¾åƒæ–‡ä»¶
        return im_files  # è¿”å›å›¾åƒæ–‡ä»¶åˆ—è¡¨

    def load_image(self, i, rect_mode=True):
        """ä»æ•°æ®é›†ä¸­åŠ è½½ä¸€å¼ å›¾åƒï¼Œè¿”å›å›¾åƒåŠå…¶è°ƒæ•´åçš„å°ºå¯¸ã€‚"""
        im, f, fn = self.ims[i], self.im_files[i], self.npy_files[i]  # è·å–å›¾åƒã€æ–‡ä»¶è·¯å¾„å’Œnumpyæ–‡ä»¶è·¯å¾„
        if im is None:  # å¦‚æœå›¾åƒæœªç¼“å­˜
            if fn.exists():  # å¦‚æœnumpyæ–‡ä»¶å­˜åœ¨
                try:
                    im = np.load(fn)  # åŠ è½½numpyæ–‡ä»¶
                except Exception as e:
                    LOGGER.warning(f"{self.prefix}WARNING âš ï¸ Removing corrupt *.npy image file {fn} due to: {e}")  # è­¦å‘Šå¹¶åˆ é™¤æŸåçš„æ–‡ä»¶
                    Path(fn).unlink(missing_ok=True)  # åˆ é™¤æŸåçš„æ–‡ä»¶
                    im = cv2.imread(f)  # è¯»å–å›¾åƒ
            else:  # è¯»å–å›¾åƒ
                im = cv2.imread(f)  # è¯»å–å›¾åƒ
            if im is None:
                raise FileNotFoundError(f"Image Not Found {f}")  # å¦‚æœå›¾åƒæœªæ‰¾åˆ°ï¼ŒæŠ›å‡ºå¼‚å¸¸

            h0, w0 = im.shape[:2]  # è·å–åŸå§‹é«˜åº¦å’Œå®½åº¦
            if rect_mode:  # å¦‚æœæ˜¯çŸ©å½¢æ¨¡å¼
                r = self.imgsz / max(h0, w0)  # è®¡ç®—ç¼©æ”¾æ¯”ä¾‹
                if r != 1:  # å¦‚æœå°ºå¯¸ä¸ç›¸ç­‰
                    w, h = (min(math.ceil(w0 * r), self.imgsz), min(math.ceil(h0 * r), self.imgsz))  # è®¡ç®—è°ƒæ•´åçš„å®½åº¦å’Œé«˜åº¦
                    im = cv2.resize(im, (w, h), interpolation=cv2.INTER_LINEAR)  # è°ƒæ•´å›¾åƒå¤§å°
            elif not (h0 == w0 == self.imgsz):  # å¦‚æœä¸æ˜¯æ­£æ–¹å½¢
                im = cv2.resize(im, (self.imgsz, self.imgsz), interpolation=cv2.INTER_LINEAR)  # æ‹‰ä¼¸å›¾åƒä¸ºæ­£æ–¹å½¢

            # å¦‚æœè®­ç»ƒæ—¶åº”ç”¨å¢å¼ºï¼Œåˆ™æ·»åŠ åˆ°ç¼“å†²åŒº
            if self.augment:
                self.ims[i], self.im_hw0[i], self.im_hw[i] = im, (h0, w0), im.shape[:2]  # ç¼“å­˜å›¾åƒåŠå…¶å°ºå¯¸
                self.buffer.append(i)  # å°†ç´¢å¼•æ·»åŠ åˆ°ç¼“å†²åŒº
                if len(self.buffer) >= self.max_buffer_length:  # å¦‚æœç¼“å†²åŒºå·²æ»¡
                    j = self.buffer.pop(0)  # ç§»é™¤æœ€æ—§çš„ç´¢å¼•
                    self.ims[j], self.im_hw0[j], self.im_hw[j] = None, None, None  # æ¸…ç©ºç¼“å­˜

            return im, (h0, w0), im.shape[:2]  # è¿”å›å›¾åƒåŠå…¶å°ºå¯¸

        return self.ims[i], self.im_hw0[i], self.im_hw[i]  # è¿”å›ç¼“å­˜çš„å›¾åƒåŠå…¶å°ºå¯¸

    def __getitem__(self, index):
        """è¿”å›ç»™å®šç´¢å¼•çš„è½¬æ¢æ ‡ç­¾ä¿¡æ¯ã€‚"""
        return self.transforms(self.get_image_and_label(index))  # åº”ç”¨è½¬æ¢å¹¶è¿”å›å›¾åƒå’Œæ ‡ç­¾

    def __len__(self):
        """è¿”å›æ•°æ®é›†ä¸­æ ‡ç­¾åˆ—è¡¨çš„é•¿åº¦ã€‚"""
        return len(self.labels)  # è¿”å›æ ‡ç­¾æ•°é‡

    def build_transforms(self, hyp=None):
        """
        ç”¨æˆ·å¯ä»¥åœ¨æ­¤è‡ªå®šä¹‰å¢å¼ºã€‚

        ç¤ºä¾‹:
            ```python
            if self.augment:
                # è®­ç»ƒè½¬æ¢
                return Compose([])
            else:
                # éªŒè¯è½¬æ¢
                return Compose([])
            ```
        """
        raise NotImplementedError  # æŠ›å‡ºæœªå®ç°å¼‚å¸¸

    def get_labels(self):
        """
        ç”¨æˆ·å¯ä»¥åœ¨æ­¤è‡ªå®šä¹‰æ ‡ç­¾æ ¼å¼ã€‚

        æ³¨æ„:
            ç¡®ä¿è¾“å‡ºæ˜¯ä¸€ä¸ªåŒ…å«ä»¥ä¸‹é”®çš„å­—å…¸:
            ```python
            dict(
                im_file=im_file,
                shape=shape,  # æ ¼å¼: (é«˜åº¦, å®½åº¦)
                cls=cls,
                bboxes=bboxes, # xywh
                segments=segments,  # xy
                keypoints=keypoints, # xy
                normalized=True, # æˆ– False
                bbox_format="xyxy",  # æˆ– xywh, ltwh
            )
            ```
        """
        raise NotImplementedError  # æŠ›å‡ºæœªå®ç°å¼‚å¸¸
```

### ä»£ç è¯´æ˜ï¼š
1. **BaseDatasetç±»**ï¼šè¿™æ˜¯ä¸€ä¸ªåŸºç¡€æ•°æ®é›†ç±»ï¼Œç»§æ‰¿è‡ªPyTorchçš„`Dataset`ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½å’Œå¤„ç†å›¾åƒæ•°æ®ã€‚
2. **åˆå§‹åŒ–æ–¹æ³•**ï¼šåœ¨åˆå§‹åŒ–æ—¶ï¼Œè®¾ç½®äº†å›¾åƒè·¯å¾„ã€å›¾åƒå¤§å°ã€æ•°æ®å¢å¼ºç­‰å‚æ•°ï¼Œå¹¶è°ƒç”¨ç›¸åº”çš„æ–¹æ³•è·å–å›¾åƒæ–‡ä»¶å’Œæ ‡ç­¾ã€‚
3. **get_img_filesæ–¹æ³•**ï¼šç”¨äºè¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„å›¾åƒæ–‡ä»¶ï¼Œæ”¯æŒç›®å½•å’Œæ–‡ä»¶åˆ—è¡¨çš„è¾“å…¥ã€‚
4. **load_imageæ–¹æ³•**ï¼šæ ¹æ®ç´¢å¼•åŠ è½½å›¾åƒï¼Œæ”¯æŒä»ç¼“å­˜ä¸­è¯»å–æˆ–ä»æ–‡ä»¶ä¸­è¯»å–ï¼Œå¹¶è¿›è¡Œå°ºå¯¸è°ƒæ•´ã€‚
5. **getitemå’Œlenæ–¹æ³•**ï¼šå®ç°äº†æ•°æ®é›†çš„ç´¢å¼•è®¿é—®å’Œé•¿åº¦è·å–ï¼Œä¾¿äºä¸PyTorchçš„DataLoaderé…åˆä½¿ç”¨ã€‚
6. **build_transformså’Œget_labelsæ–¹æ³•**ï¼šè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯ç•™ç»™ç”¨æˆ·è‡ªå®šä¹‰çš„ï¼Œå…è®¸ç”¨æˆ·æ ¹æ®éœ€æ±‚å®ç°æ•°æ®å¢å¼ºå’Œæ ‡ç­¾æ ¼å¼çš„è‡ªå®šä¹‰ã€‚

è¿™ä¸ªç¨‹åºæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªåä¸º `BaseDataset` çš„ç±»ï¼Œä¸»è¦ç”¨äºåŠ è½½å’Œå¤„ç†å›¾åƒæ•°æ®ï¼Œç‰¹åˆ«æ˜¯åœ¨è®­ç»ƒæ·±åº¦å­¦ä¹ æ¨¡å‹æ—¶ã€‚è¿™ä¸ªç±»ç»§æ‰¿è‡ª PyTorch çš„ `Dataset` ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•å’Œå±æ€§æ¥ç®¡ç†å›¾åƒåŠå…¶æ ‡ç­¾ã€‚

åœ¨åˆå§‹åŒ–æ–¹æ³• `__init__` ä¸­ï¼Œç±»æ¥å—å¤šä¸ªå‚æ•°ï¼Œä¾‹å¦‚å›¾åƒè·¯å¾„ã€å›¾åƒå¤§å°ã€æ˜¯å¦ç¼“å­˜å›¾åƒã€æ•°æ®å¢å¼ºé€‰é¡¹ã€è¶…å‚æ•°ã€æ‰¹é‡å¤§å°ç­‰ã€‚æ ¹æ®è¿™äº›å‚æ•°ï¼Œç±»ä¼šåŠ è½½å›¾åƒæ–‡ä»¶ã€æ ‡ç­¾ï¼Œå¹¶è¿›è¡Œå¿…è¦çš„é¢„å¤„ç†ã€‚

`get_img_files` æ–¹æ³•ç”¨äºè¯»å–æŒ‡å®šè·¯å¾„ä¸‹çš„å›¾åƒæ–‡ä»¶ã€‚å®ƒæ”¯æŒè¯»å–ç›®å½•ä¸­çš„æ‰€æœ‰å›¾åƒæ–‡ä»¶ï¼Œå¹¶å°†å…¶è·¯å¾„å­˜å‚¨åœ¨ `im_files` åˆ—è¡¨ä¸­ã€‚å¦‚æœæŒ‡å®šäº†ç±»çš„åˆ—è¡¨ï¼Œ`update_labels` æ–¹æ³•ä¼šæ›´æ–°æ ‡ç­¾ï¼Œåªä¿ç•™æ‰€éœ€çš„ç±»ä¿¡æ¯ã€‚

`load_image` æ–¹æ³•ç”¨äºåŠ è½½å•ä¸ªå›¾åƒã€‚å¦‚æœå›¾åƒå·²ç»ç¼“å­˜ï¼Œå®ƒä¼šç›´æ¥è¿”å›ç¼“å­˜çš„å›¾åƒï¼›å¦åˆ™ï¼Œå®ƒä¼šä»æ–‡ä»¶ä¸­è¯»å–å›¾åƒï¼Œå¹¶æ ¹æ®æŒ‡å®šçš„æ¨¡å¼è°ƒæ•´å›¾åƒå¤§å°ã€‚è¯¥æ–¹æ³•è¿˜ä¼šåœ¨è¿›è¡Œæ•°æ®å¢å¼ºæ—¶å°†å›¾åƒæ·»åŠ åˆ°ç¼“å†²åŒºã€‚

`cache_images` æ–¹æ³•å…è®¸å°†å›¾åƒç¼“å­˜åˆ°å†…å­˜æˆ–ç£ç›˜ï¼Œä»¥åŠ å¿«åç»­çš„åŠ è½½é€Ÿåº¦ã€‚å®ƒä½¿ç”¨å¤šçº¿ç¨‹æ¥å¹¶è¡Œå¤„ç†å›¾åƒåŠ è½½ï¼Œç¡®ä¿åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­èƒ½å¤Ÿå¿«é€Ÿè·å–å›¾åƒæ•°æ®ã€‚

`check_cache_ram` æ–¹æ³•ç”¨äºæ£€æŸ¥å½“å‰ç³»ç»Ÿçš„å¯ç”¨å†…å­˜ï¼Œä»¥ç¡®å®šæ˜¯å¦å¯ä»¥å°†å›¾åƒç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚å®ƒä¼šè®¡ç®—æ‰€éœ€çš„å†…å­˜å¹¶ä¸å¯ç”¨å†…å­˜è¿›è¡Œæ¯”è¾ƒã€‚

`set_rectangle` æ–¹æ³•è®¾ç½®ç”¨äº YOLO æ£€æµ‹çš„è¾¹ç•Œæ¡†å½¢çŠ¶ä¸ºçŸ©å½¢ï¼Œç¡®ä¿åœ¨è®­ç»ƒæ—¶å›¾åƒçš„é•¿å®½æ¯”å¾—åˆ°åˆç†å¤„ç†ã€‚

`__getitem__` æ–¹æ³•æ ¹æ®ç´¢å¼•è¿”å›ç»è¿‡å˜æ¢çš„æ ‡ç­¾ä¿¡æ¯ï¼Œè€Œ `get_image_and_label` æ–¹æ³•åˆ™è´Ÿè´£è·å–å›¾åƒåŠå…¶æ ‡ç­¾çš„è¯¦ç»†ä¿¡æ¯ã€‚`__len__` æ–¹æ³•è¿”å›æ ‡ç­¾åˆ—è¡¨çš„é•¿åº¦ï¼Œè¡¨ç¤ºæ•°æ®é›†ä¸­çš„æ ·æœ¬æ•°é‡ã€‚

`build_transforms` å’Œ `get_labels` æ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è‡ªå®šä¹‰æ•°æ®å¢å¼ºå’Œæ ‡ç­¾æ ¼å¼ã€‚è¿™äº›æ–¹æ³•çš„å®ç°å°†ç”±ç»§æ‰¿ `BaseDataset` ç±»çš„å…·ä½“æ•°æ®é›†ç±»æ¥å®Œæˆã€‚

æ€»çš„æ¥è¯´ï¼Œè¿™ä¸ªç±»æä¾›äº†ä¸€ä¸ªçµæ´»çš„æ¡†æ¶ï¼Œç”¨äºå¤„ç†å›¾åƒæ•°æ®é›†ï¼Œæ”¯æŒå¤šç§é…ç½®é€‰é¡¹ï¼Œé€‚ç”¨äºè®­ç»ƒè®¡ç®—æœºè§†è§‰æ¨¡å‹ã€‚

### 12.ç³»ç»Ÿæ•´ä½“ç»“æ„ï¼ˆèŠ‚é€‰ï¼‰

### ç¨‹åºæ•´ä½“åŠŸèƒ½å’Œæ„æ¶æ¦‚æ‹¬

è¯¥ç¨‹åºæ˜¯ä¸€ä¸ªåŸºäºYOLOv8ç®—æ³•çš„ç›®æ ‡æ£€æµ‹æ¡†æ¶ï¼Œæ—¨åœ¨æä¾›ä¸€ä¸ªå®Œæ•´çš„è®­ç»ƒã€éªŒè¯å’Œæ¨ç†æµç¨‹ã€‚ç¨‹åºçš„æ¶æ„åˆ†ä¸ºå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ç‰¹å®šçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ•°æ®å¤„ç†ã€æ¨¡å‹æ„å»ºã€è®­ç»ƒè¿‡ç¨‹ç®¡ç†ã€æŸå¤±è®¡ç®—ã€å¯è§†åŒ–ç­‰ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡ï¼Œç¨‹åºä¾¿äºæ‰©å±•å’Œç»´æŠ¤ï¼Œèƒ½å¤Ÿæ”¯æŒå¤šç§ç›®æ ‡æ£€æµ‹ä»»åŠ¡å’Œåº”ç”¨åœºæ™¯ã€‚

### æ–‡ä»¶åŠŸèƒ½æ•´ç†è¡¨

| æ–‡ä»¶è·¯å¾„                                                       | åŠŸèƒ½æè¿°                                                         |
|------------------------------------------------------------|---------------------------------------------------------------|
| `ui.py`                                                    | æä¾›å‘½ä»¤è¡Œæ¥å£ï¼Œè¿è¡ŒStreamlit Webåº”ç”¨ä»¥å±•ç¤ºæ¨¡å‹ç»“æœã€‚               |
| `code\ultralytics\trackers\utils\matching.py`            | å®ç°ç›®æ ‡åŒ¹é…å’Œè·Ÿè¸ªçš„ç›¸å…³åŠŸèƒ½ï¼ŒåŒ…æ‹¬è®¡ç®—IoUå’ŒåµŒå…¥è·ç¦»ã€‚               |
| `code\ultralytics\trackers\__init__.py`                  | æ ‡è¯†ç›®å½•ä¸ºPythonåŒ…ï¼Œç»„ç»‡YOLOv8çš„è·Ÿè¸ªæ¨¡å—ã€‚                           |
| `code\ultralytics\models\sam\amg.py`                     | å¤„ç†å›¾åƒè£å‰ªã€æ¢å¤å’Œæ©è†œå¤„ç†ï¼Œä¸ºç›®æ ‡æ£€æµ‹æä¾›å‡†å¤‡å·¥ä½œã€‚                |
| `code\ultralytics\models\sam\modules\__init__.py`        | æ ‡è¯†ç›®å½•ä¸ºPythonåŒ…ï¼Œç»„ç»‡YOLOv8çš„SAMæ¨¡å—ã€‚                           |
| `train.py`                                                | æä¾›YOLOæ¨¡å‹çš„è®­ç»ƒæ¡†æ¶ï¼ŒåŒ…æ‹¬æ•°æ®é›†æ„å»ºã€æ¨¡å‹è®¾ç½®å’Œè®­ç»ƒç›‘æ§ã€‚          |
| `code\ultralytics\data\base.py`                          | å®šä¹‰æ•°æ®é›†çš„åŸºæœ¬ç»“æ„å’ŒåŠŸèƒ½ï¼Œæ”¯æŒæ•°æ®åŠ è½½å’Œé¢„å¤„ç†ã€‚                   |
| `code\ultralytics\models\yolo\detect\__init__.py`       | åˆå§‹åŒ–YOLOæ£€æµ‹æ¨¡å‹ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒæ¨¡å‹åŠ è½½å’Œæ¨ç†ã€‚                     |
| `code\ultralytics\models\nas\model.py`                   | å®ç°ç¥ç»æ¶æ„æœç´¢ï¼ˆNASï¼‰ç›¸å…³çš„æ¨¡å‹å®šä¹‰å’ŒåŠŸèƒ½ã€‚                        |
| `code\ultralytics\models\yolo\segment\train.py`          | æä¾›YOLOæ¨¡å‹çš„åˆ†å‰²ä»»åŠ¡è®­ç»ƒåŠŸèƒ½ã€‚                                   |
| `code\ultralytics\utils\callbacks\comet.py`              | é›†æˆComet.mlç”¨äºè®­ç»ƒè¿‡ç¨‹çš„ç›‘æ§å’Œå¯è§†åŒ–ã€‚                           |
| `code\ultralytics\data\dataset.py`                        | å®šä¹‰æ•°æ®é›†ç±»ï¼Œå¤„ç†æ•°æ®åŠ è½½å’Œå¢å¼ºç­‰åŠŸèƒ½ã€‚                             |
| `code\ultralytics\nn\modules\conv.py`                    | å®ç°å·ç§¯å±‚çš„å®šä¹‰å’Œç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒæ¨¡å‹çš„æ„å»ºã€‚                         |

è¿™ä¸ªè¡¨æ ¼æä¾›äº†å„ä¸ªæ–‡ä»¶çš„åŠŸèƒ½æ¦‚è¿°ï¼Œå¸®åŠ©ç†è§£æ•´ä¸ªYOLOv8ç›®æ ‡æ£€æµ‹æ¡†æ¶çš„ç»“æ„å’Œä½œç”¨ã€‚

æ³¨æ„ï¼šç”±äºæ­¤åšå®¢ç¼–è¾‘è¾ƒæ—©ï¼Œä¸Šé¢â€œ11.é¡¹ç›®æ ¸å¿ƒæºç è®²è§£ï¼ˆå†ä¹Ÿä¸ç”¨æ‹…å¿ƒçœ‹ä¸æ‡‚ä»£ç é€»è¾‘ï¼‰â€ä¸­éƒ¨åˆ†ä»£ç å¯èƒ½ä¼šä¼˜åŒ–å‡çº§ï¼Œä»…ä¾›å‚è€ƒå­¦ä¹ ï¼Œå®Œæ•´â€œè®­ç»ƒæºç â€ã€â€œWebå‰ç«¯ç•Œé¢â€å’Œâ€œ70+ç§åˆ›æ–°ç‚¹æºç â€ä»¥â€œ13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–â€çš„å†…å®¹ä¸ºå‡†ã€‚

### 13.å®Œæ•´è®­ç»ƒ+Webå‰ç«¯ç•Œé¢+70+ç§åˆ›æ–°ç‚¹æºç ã€æ•°æ®é›†è·å–

![19.png](19.png)


# [ä¸‹è½½é“¾æ¥ï¼šhttps://mbd.pub/o/bread/ZpuUmZ9t](https://mbd.pub/o/bread/ZpuUmZ9t)